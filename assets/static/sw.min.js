(function(){'use strict';const n="/students/ /teachers/ /assets/style/main.css /assets/style/substitutions.css /assets/style/main-dark.css /assets/style/substitutions-dark.css /assets/js/substitutions.min.js /assets/js/dark-theme.min.js /assets/js/timetables.min.js /favicon-32x32.png".split(" ");self.addEventListener("install",a=>{a.waitUntil(caches.open("gawvertretung-cache-v1").then(b=>{n.map(c=>{let e=c;if("/students/"===c||"/teachers/"===c)e+="?all";fetch(e).then(d=>b.put(c,d))})}))});
function p(a,b=null){fetch("/api/report-error",{method:"post",body:new URLSearchParams({name:a.name,message:(null==b?void 0:b.message)||a.message,description:a.description,number:a.number,filename:(null==b?void 0:b.filename)||a.fileName,lineno:(null==b?void 0:b.lineno)||a.lineNumber,colno:(null==b?void 0:b.colno)||a.columnNumber,stack:(null==b?void 0:b.stack)||a.stack,user_agent:navigator.userAgent})}).catch(c=>console.error("reporting error failed",c))}
self.addEventListener("error",a=>{p(a.error,a)});self.addEventListener("unhandledrejection",a=>{console.log("unhandledrejection",a);p(a.reason)});
self.addEventListener("fetch",a=>{const b=new URL(a.request.url);console.log("requested",a.request.url,b.pathname);"/"===b.pathname?a.respondWith(Response.redirect("/students/")):n.includes(b.pathname)?a.respondWith((new Promise((c,e)=>{console.log("fetching",a.request);fetch(a.request).then(d=>{console.log("fetch successful",a.request.url);c(d.clone());"/students/"!==b.pathname&&"/teachers/"!==b.pathname||""!==b.search?(console.log("saving response in cache",a.request.url),caches.open("gawvertretung-cache-v1").then(l=>
l.put(new Request(b.pathname),d))):console.log("not saving in cache",a.request.url)},e)})).catch(()=>caches.open("gawvertretung-cache-v1").then(c=>c.match(a.request,{ignoreSearch:!0}).then(e=>{if(e)return e;console.log("no match for",a.request);return Promise.reject("no-match")})))):console.log("not using SW for request")});
self.addEventListener("push",async a=>{const b=a.data.json();let c=b.timestamp,e=b.plan_id,d=b.affected_groups_by_day;console.log("affectedGroups",d);for(let h of Object.values(d))h.groups=new Set(h.groups);let l=Date.now()/1E3;a.waitUntil(self.registration.getNotifications().then(h=>{for(var f of h)if(f.data&&f.data.plan_id===e){for(let [g,m]of Object.entries(f.data.affected_groups_by_day))console.log("expiryTime, currentTimestamp:",g,l),g>l&&(console.log("add",m.groups),g in d?(console.log("already in affectedGroups"),
m.groups.forEach(q=>d[g].groups.add(q))):(console.log("new day",m),d[g]=m));f.close()}for(let g of Object.values(d))g.groups=Array.from(g.groups);if(1===Object.keys(d).length){var k=Object.values(d)[0];h=k.name+": Neue Vertretungen";f=k.groups.join(", ")}else{h="Neue Vertretungen";f="";for(k of Object.values(d))f+=k.name+": "+k.groups.join(", ")+"\n"}k={body:f,icon:"android-chrome-512x512.png",badge:"favicon-monochrome-96x96.png",lang:"de",timestamp:c,vibrate:[300,100,400],data:{plan_id:e,url:(new URL("/"+
e+"/",self.location.origin)).href,affected_groups_by_day:d}};self.registration.showNotification(h,k)}))});
self.addEventListener("notificationclick",a=>{a.notification.close();a.waitUntil(self.clients.matchAll({type:"window"}).then(function(b){for(let c of b)if(b=new URL(c.url),console.log(a.notification.data.url,b.origin+b.pathname),b.origin+b.pathname===a.notification.data.url&&"focus"in c)return c.focus();if(self.clients.openWindow)return self.clients.openWindow(a.notification.data.url)}));self.registration.getNotifications().then(b=>{b.forEach(c=>{null!=c.data&&c.data.plan_id===a.notification.data.plan_id&&
c.close()})})});}).call(this);

//# sourceMappingURL=sw.min.js.map
