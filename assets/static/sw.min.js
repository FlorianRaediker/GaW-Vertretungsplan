(function(){'use strict';function m(a,b=null){fetch("/api/report-error",{method:"post",body:new URLSearchParams({name:a.name,message:(null==b?void 0:b.message)||a.message,description:a.description,number:a.number,filename:(null==b?void 0:b.filename)||a.fileName,lineno:(null==b?void 0:b.lineno)||a.lineNumber,colno:(null==b?void 0:b.colno)||a.columnNumber,stack:(null==b?void 0:b.stack)||a.stack,user_agent:navigator.userAgent})}).catch(c=>console.error("reporting error failed",c))}
self.addEventListener("error",a=>{m(a.error,a)});self.addEventListener("unhandledrejection",a=>{console.log("unhandledrejection",a);m(a.reason)});self.addEventListener("fetch",()=>{});
self.addEventListener("push",async a=>{const b=a.data.json();let c=b.timestamp,l=b.plan_id,d=b.affected_groups_by_day;console.log("affectedGroups",d);for(let g of Object.values(d))g.groups=new Set(g.groups);let n=Date.now()/1E3;a.waitUntil(self.registration.getNotifications().then(g=>{for(var e of g)if(e.data&&e.data.plan_id===l){for(let [f,k]of Object.entries(e.data.affected_groups_by_day))console.log("expiryTime, currentTimestamp:",f,n),f>n&&(console.log("add",k.groups),f in d?(console.log("already in affectedGroups"),
k.groups.forEach(p=>d[f].groups.add(p))):(console.log("new day",k),d[f]=k));e.close()}for(let f of Object.values(d))f.groups=Array.from(f.groups);if(1===Object.keys(d).length){var h=Object.values(d)[0];g=h.name+": Neue Vertretungen";e=h.groups.join(", ")}else{g="Neue Vertretungen";e="";for(h of Object.values(d))e+=h.name+": "+h.groups.join(", ")+"\n"}h={body:e,icon:"android-chrome-512x512.png",badge:"favicon-monochrome-96x96.png",lang:"de",timestamp:c,vibrate:[300,100,400],data:{plan_id:l,url:(new URL("/"+
l+"/",self.location.origin)).href,affected_groups_by_day:d}};self.registration.showNotification(g,h)}))});
self.addEventListener("notificationclick",a=>{a.notification.close();a.waitUntil(self.clients.matchAll({type:"window"}).then(function(b){for(let c of b)if(b=new URL(c.url),console.log(a.notification.data.url,b.origin+b.pathname),b.origin+b.pathname===a.notification.data.url&&"focus"in c)return c.focus();if(self.clients.openWindow)return self.clients.openWindow(a.notification.data.url)}));self.registration.getNotifications().then(b=>{b.forEach(c=>{null!=c.data&&c.data.plan_id===a.notification.data.plan_id&&
c.close()})})});}).call(this);

//# sourceMappingURL=sw.min.js.map
