(function(){'use strict';const m=["/students/","/teachers/"],n="/assets/style/main.css /assets/style/main-dark.css /assets/style/substitutions.css /assets/style/substitutions-dark.css /assets/js/substitutions.min.js /assets/js/dark-theme.min.js /assets/js/timetables.min.js /favicon-32x32.png /android-chrome-192x192.png".split(" ");self.addEventListener("install",a=>{a.waitUntil(caches.open("gawvertretung-v1").then(c=>Promise.all([Promise.all(m.map(d=>fetch(d+"?all&sw").then(b=>c.put(d,b))))])))});
self.addEventListener("activate",a=>{a.waitUntil(caches.open("gawvertretung-v1").then(c=>{c.keys().then(d=>Promise.all(d.map(b=>{const f=new URL(b.url);if(!n.includes(f.pathname)&&!m.includes(f.pathname))return console.log("cache: delete old",b),c.delete(b)})))}))});
self.addEventListener("fetch",a=>{const c=new URL(a.request.url);console.log("requested",a.request.url,c.pathname);"/"===c.pathname?a.respondWith(Response.redirect("/students/")):m.includes(c.pathname)?a.respondWith((new Promise((d,b)=>{console.log("fetching",a.request);fetch(a.request).then(f=>{console.log("fetch successful",a.request.url);d(f.clone());caches.open("gawvertretung-v1").then(e=>e.put(c.pathname,f))},b)})).catch(()=>caches.open("gawvertretung-v1").then(d=>d.match(c.pathname,{ignoreSearch:!0}).then(b=>
{if(b)return b;console.log("no match for",a.request);return Promise.reject("no-match")})))):n.includes(c.pathname)?a.respondWith(new Promise(d=>caches.open("gawvertretung-v1").then(b=>b.match(a.request).then(f=>{f?(console.log("cache has up-to-date response for",a.request.url),d(f)):fetch(a.request).then(async e=>{console.log("cache is missing up-to-date response, fetching for",a.request.url);d(e.clone());await b.delete(a.request,{ignoreSearch:!0,ignoreVary:!0}).then(g=>console.log("deleted",g,a.request.url));
console.log("putting in cache:",a.request.url);await b.put(a.request,e)}).catch(()=>{d(b.match(a.request,{ignoreSearch:!0,ignoreVary:!0}))})})))):console.log("not using SW for request")});
self.addEventListener("push",async a=>{const c=a.data.json();let d=c.plan_id,b=c.affected_groups_by_day;console.log("affectedGroups",b);for(let e of Object.values(b))e.groups=new Set(e.groups);let f=Date.now()/1E3;a.waitUntil(self.registration.getNotifications().then(e=>{for(var g of e)if(g.data&&g.data.plan_id===d){for(let [h,l]of Object.entries(g.data.affected_groups_by_day))console.log("expiryTime, currentTimestamp:",h,f),h>f&&(console.log("add",l.groups),h in b?(console.log("already in affectedGroups"),
l.groups.forEach(p=>b[h].groups.add(p))):(console.log("new day",l),b[h]=l));g.close()}for(let h of Object.values(b))h.groups=Array.from(h.groups);if(1===Object.keys(b).length){var k=Object.values(b)[0];e=k.name+": Neue Vertretungen";g=k.groups.join(", ")}else{e="Neue Vertretungen";g="";for(k of Object.values(b))g+=k.name+": "+k.groups.join(", ")+"\n"}k={body:g,icon:"android-chrome-512x512.png",badge:"monochrome-96x96.png",lang:"de",vibrate:[300,100,400],data:{plan_id:d,url:(new URL("/"+d+"/",self.location.origin)).href,
affected_groups_by_day:b,notification_id:c.notification_id}};self.registration.showNotification(e,k)}))});
self.addEventListener("notificationclick",a=>{a.notification.close();a.waitUntil(Promise.all([self.clients.matchAll({type:"window"}).then(function(c){for(let d of c)if(c=new URL(d.url),console.log(a.notification.data.url,c.origin+c.pathname),c.origin+c.pathname===a.notification.data.url&&"focus"in d)return d.focus();if(self.clients.openWindow)return self.clients.openWindow(a.notification.data.url)}),self.registration.getNotifications().then(c=>{c.forEach(d=>{null!=d.data&&d.data.plan_id===a.notification.data.plan_id&&
d.close()})})]))});}).call(this);

//# sourceMappingURL=sw.min.js.map
