{"version":3,"sources":["assets/static/assets/js/substitutions.js"],"names":["greySubstitutions","now","Date","dates","length","innerHTML","getDate","getMonth","getFullYear","b2","getHours","c2","getMinutes","i","x","document","getElementsByClassName","classList","add","setTimeout","getTime","e","console","error","substitutionPlanType","window","location","pathname","split","toggleNotifications","getElementById","notificationsInfo","notificationsInfo_none","notificationsInfo_all","notificationsInfo_selection","notificationsInfo_blocked","notificationsInfo_failed","base64UrlToUint8Array","base64UrlData","padding","repeat","base64","replace","rawData","atob","buffer","Uint8Array","charCodeAt","subscribePush","isActive","registration","Promise","resolve","reject","pushManager","subscribe","userVisibleOnly","applicationServerKey","then","subscription","log","fetch","origin","method","body","JSON","stringify","toJSON","selection","is_active","response","json","data","ok","catch","reason","notificationState","setNotificationsInfo","state","localStorage","setItem","checked","disabled","onNotificationsAvailable","reloadPermissionState","startsWith","Notification","permission","hidden","addEventListener","requestPermission","getItem","navigator","serviceWorker","ready","active","warn","register","updateWebSocket","webSocket","readyState","OPEN","send","type","status","textContent","createWebSocket","openCallback","WebSocket","protocol","host","event","onOnline","onOffline","msg","parse","reload","onlineStatus","remove","close","value","timetables","SyntaxError","timetablesBlock","setRelevant","input","markRelevant","dataset","substitutions","s","weekdayName","teacher","toUpperCase","lesson","row","substitutionsBox","tableBody","querySelector","newGroupSubstitutions","affectedGroups","match","groupName","groupNumberPart","groupLetterPart","letter","push","matchingSelections","g","includes","dayName","l","Object","assign","groupSubstitutions","children","groupNameCell","teacherName","lessonString","parseInt","timetablesBlockTemplate","timetableTemplate","appendChild","content","timetablesContainer","timetable","firstElementChild","cloneNode","innerText","tbody","lessonNum","focusNextWeekday","currentInput","direction","weekday","focus","focusNextLesson","createElement","th","cell","id","setAttribute","target","select","oldvalue","key","shiftKey","preventDefault","selectionStart","selectionEnd","maxLength"],"mappings":"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","file":"substitutions.min.js","sourcesContent":["// ==================\r\n// GREY SUBSTITUTIONS\r\ntry {\r\n    const dates = document.getElementsByClassName(\"date\");\r\n\r\n    function greySubstitutions() {\r\n        const now = new Date();\r\n        if (dates.length > 0 && dates[0].innerHTML === now.getDate() + \".\" + (now.getMonth() + 1) + \".\" + now.getFullYear()) {\r\n            const b2 = now.getHours();\r\n            const c2 = now.getMinutes();\r\n            for (let i of [\r\n                [\"1\", 8, 35],\r\n                [\"2\", 9, 25],\r\n                [\"3\", 10, 30],\r\n                [\"4\", 11, 15],\r\n                [\"5\", 12, 20],\r\n                [\"6\", 13, 10],\r\n                [\"7\", 14, 35],\r\n                [\"8\", 15, 25],\r\n                [\"9\", 16, 20],\r\n                [\"10\", 17, 5]\r\n            ]) {\r\n                if (i[1] < b2 || (i[1] === b2 && i[2] <= c2)) {\r\n                    for (let x of document.getElementsByClassName(\"lesson\" + i[0])) {\r\n                        x.classList.add(\"grey\");\r\n                    }\r\n                } else {\r\n                    // noinspection JSCheckFunctionSignatures\r\n                    setTimeout(greySubstitutions, new Date(now.getFullYear(), now.getMonth(), now.getDate(), i[1], i[2]).getTime() - now.getTime());\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    greySubstitutions();\r\n} catch (e) {\r\n    console.error(e);\r\n}\r\nlet substitutionPlanType = window.location.pathname.split(\"/\", 2)[1];\r\n\r\n\r\n// ============\r\n// PUSH NOTIFICATIONS\r\n\r\nconst toggleNotifications = document.getElementById(\"toggle-notifications\");\r\nconst notificationsInfo = document.getElementById(\"notifications-info\");\r\nconst notificationsInfo_none = document.getElementById(\"notifications-info-none\");\r\nconst notificationsInfo_all = document.getElementById(\"notifications-info-all\");\r\nconst notificationsInfo_selection = document.getElementById(\"notifications-info-selection\");\r\nconst notificationsInfo_blocked = document.getElementById(\"notifications-info-blocked\");\r\nconst notificationsInfo_failed = document.getElementById(\"notifications-info-failed\");\r\n\r\nfunction base64UrlToUint8Array(base64UrlData) {\r\n    const padding = '='.repeat((4 - base64UrlData.length % 4) % 4);\r\n    const base64 = (base64UrlData + padding)\r\n        .replace(/-/g, '+')\r\n        .replace(/_/g, '/');\r\n\r\n    const rawData = atob(base64);\r\n    const buffer = new Uint8Array(rawData.length);\r\n\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n        buffer[i] = rawData.charCodeAt(i);\r\n    }\r\n\r\n    return buffer;\r\n}\r\n\r\nfunction subscribePush(isActive, registration) {\r\n    return new Promise((resolve, reject) => {\r\n        registration.pushManager.subscribe({\r\n            userVisibleOnly: true,\r\n            applicationServerKey: base64UrlToUint8Array(\"BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8\")\r\n        }).then(subscription => {\r\n            console.log(\"Got push subscription:\", subscription, isActive ? \"(active)\" : \"(not active)\");\r\n            fetch(window.location.origin + window.location.pathname + \"api/subscribe-push\", {\r\n                method: \"post\",\r\n                \"headers\": {\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({subscription: subscription.toJSON(), selection: selection, is_active: isActive})\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    if (data.ok) {\r\n                        console.log(\"Push subscription successful\");\r\n                        resolve();\r\n                    } else {\r\n                        console.error(\"Push subscription failed\", data);\r\n                        reject();\r\n                    }\r\n                });\r\n        }).catch(reason => {\r\n            console.error(\"Push subscription failed\", reason);\r\n            reject(reason);\r\n        });\r\n    });\r\n}\r\n\r\n\r\nlet notificationState;\r\n\r\nfunction setNotificationsInfo(state, registration) {\r\n    console.log(\"Setting notification-state to\", state);\r\n    notificationState = state;\r\n    window.localStorage.setItem(substitutionPlanType + \"-notification-state\", notificationState);\r\n    switch (notificationState) {\r\n        case \"granted-and-enabled\":\r\n            toggleNotifications.checked = true;\r\n            toggleNotifications.disabled = false;\r\n            if (selection !== \"\") {\r\n                notificationsInfo.innerHTML = notificationsInfo_selection.innerHTML.replace(\"{selection}\", selection);\r\n            } else {\r\n                notificationsInfo.innerHTML = notificationsInfo_all.innerHTML;\r\n            }\r\n            subscribePush(true, registration)\r\n                .catch(reason => {\r\n                    console.error(\"Push subscription failed\", reason);\r\n                    setNotificationsInfo(\"failed\", registration);\r\n                });\r\n            break;\r\n        case \"denied\":\r\n            toggleNotifications.checked = false;\r\n            toggleNotifications.disabled = true;\r\n            notificationsInfo.innerHTML = notificationsInfo_blocked.innerHTML;\r\n            break;\r\n        case \"failed\":\r\n            toggleNotifications.checked = false;\r\n            toggleNotifications.disabled = true;\r\n            notificationsInfo.innerHTML = notificationsInfo_failed.innerHTML;\r\n            break;\r\n        case \"granted-and-disabled\":\r\n            subscribePush(false, registration)\r\n                .catch(reason => {\r\n                    console.error(\"Push subscription failed\", reason);\r\n                    setNotificationsInfo(\"failed\", registration);\r\n                });\r\n            toggleNotifications.checked = false;\r\n            toggleNotifications.disabled = false;\r\n            notificationsInfo.innerHTML = notificationsInfo_none.innerHTML;\r\n            break;\r\n        default:\r\n        case \"default\":\r\n            toggleNotifications.checked = false;\r\n            toggleNotifications.disabled = false;\r\n            notificationsInfo.innerHTML = notificationsInfo_none.innerHTML;\r\n            break;\r\n    }\r\n}\r\n\r\nfunction onNotificationsAvailable(registration) {\r\n    document.getElementById(\"notifications-not-available-alert\").hidden = true;\r\n    document.getElementById(\"toggle-notifications-wrapper\").hidden = false;\r\n    toggleNotifications.addEventListener(\"change\", () => {\r\n        if (toggleNotifications.checked) {\r\n            window.Notification.requestPermission()\r\n                .then(permission => {\r\n                    switch (permission) {\r\n                        case \"granted\":\r\n                            notificationState = \"granted-and-enabled\";\r\n                            break;\r\n                        default:\r\n                            notificationState = permission;\r\n                    }\r\n                    setNotificationsInfo(notificationState, registration);\r\n                });\r\n        } else {\r\n            if (notificationState === \"granted-and-enabled\") {\r\n                setNotificationsInfo(\"granted-and-disabled\", registration);\r\n            }\r\n        }\r\n    });\r\n\r\n    function reloadPermissionState() {\r\n        if (!notificationState.startsWith(Notification.permission)) {\r\n            // permission has been changed\r\n            if (Notification.permission === \"granted\") {\r\n                setNotificationsInfo(\"granted-and-disabled\", registration);\r\n            } else {\r\n                setNotificationsInfo(Notification.permission, registration);\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    window.addEventListener(\"focus\", reloadPermissionState);\r\n\r\n    notificationState = window.localStorage.getItem(substitutionPlanType + \"-notification-state\");\r\n    if (notificationState == null)\r\n        notificationState = \"default\";\r\n    if (!reloadPermissionState()) {\r\n        setNotificationsInfo(notificationState, registration);\r\n    }\r\n}\r\n\r\nif (\"serviceWorker\" in navigator) {\r\n    window.addEventListener(\"load\", () => {\r\n        navigator.serviceWorker.ready\r\n            .then(registration => {\r\n                console.log(\"ServiceWorker is active:\", registration.active);\r\n                if (!(\"Notification\" in window)) {\r\n                    console.warn(\"Notification is not supported\");\r\n                    return;\r\n                }\r\n                if (!(\"localStorage\" in window)) {\r\n                    console.warn(\"localStorage is not supported\");\r\n                    return;\r\n                }\r\n                if (!(\"PushManager\" in window)) {\r\n                    console.warn(\"PushManager is not supported\");\r\n                    return;\r\n                }\r\n                onNotificationsAvailable(registration);\r\n            });\r\n        navigator.serviceWorker.register(\"/sw.min.js\")\r\n            .then(registration => {\r\n                console.log(\"ServiceWorker registration successful:\", registration);\r\n            }).catch(reason => console.warn(\"ServiceWorker registration failed:\", reason))\r\n    });\r\n} else {\r\n    console.warn(\"serviceWorker is not supported\");\r\n}\r\n\r\n\r\n// =================\r\n// WEBSOCKET UPDATES\r\n\r\ntry {\r\n    const onlineStatus = document.getElementById(\"online-status\");\r\n\r\n    let webSocket = null;\r\n    function onOnline() {\r\n        onlineStatus.textContent = \"Aktuell\";\r\n        onlineStatus.classList.add(\"online\");\r\n        onlineStatus.classList.remove(\"offline\");\r\n    }\r\n    function onOffline() {\r\n        onlineStatus.textContent = \"Keine Verbindung zum Server\";\r\n        onlineStatus.classList.add(\"offline\");\r\n        onlineStatus.classList.remove(\"online\");\r\n    }\r\n    function createWebSocket(openCallback=null) {\r\n        webSocket = new WebSocket(\r\n            (window.location.protocol === \"http:\" ? \"ws:\" : \"wss:\") + \"//\" +\r\n            window.location.host + window.location.pathname + \"api/wait-for-updates\");\r\n\r\n        webSocket.addEventListener(\"open\", event => {\r\n            console.log(\"WebSocket opened\", event);\r\n            onOnline();\r\n            if (openCallback)\r\n                openCallback();\r\n        });\r\n        webSocket.addEventListener(\"close\", event => {\r\n            console.log(\"WebSocket closed\", event);\r\n            onOffline();\r\n        });\r\n        webSocket.addEventListener(\"message\", event => {\r\n            const msg = JSON.parse(event.data);\r\n            console.log(\"WebSocket message\", msg);\r\n            switch (msg.type) {\r\n                /*case \"heartbeat\":\r\n                    clearTimeout(disconnectTimeout);\r\n                    break;*/\r\n                case \"new_substitutions\":\r\n                    window.location.reload();\r\n                    break;\r\n                default:\r\n                    console.warn(\"Unknown WebSocket message type\");\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n    createWebSocket();\r\n\r\n    function updateWebSocket() {\r\n        // Send status to server. The server checks whether the status is still up-to-date. If not, it sends a\r\n        // message, and thus the page is reloaded.\r\n        if (webSocket.readyState === webSocket.OPEN) {\r\n            webSocket.send(JSON.stringify({type: \"check_status\", status: document.getElementById(\"status\").textContent}));\r\n        } else {\r\n            createWebSocket(() => webSocket.send(JSON.stringify({type: \"check_status\", status: document.getElementById(\"status\").textContent})));\r\n        }\r\n    }\r\n\r\n    window.addEventListener(\"focus\", () => {\r\n        console.log(\"focus, checking for new substitutions\");\r\n        updateWebSocket();\r\n    });\r\n\r\n    window.addEventListener(\"online\", () => {\r\n        console.log(\"online, checking for new substitutions\");\r\n        updateWebSocket();\r\n    });\r\n    window.addEventListener(\"offline\", () => {\r\n        console.log(\"offline, closing WebSocket connection\");\r\n        onOffline();\r\n        webSocket.close();\r\n    });\r\n} catch (e) {\r\n    console.error(e);\r\n}\r\n\r\n\r\n// =================\r\n// TIMETABLES\r\n\r\nconst selection = document.getElementById(\"selectionInput\").value;\r\n\r\ntry {\r\n    let timetables;\r\n    try {\r\n        timetables = JSON.parse(window.localStorage.getItem(substitutionPlanType + \"-timetables\"));\r\n        if (!timetables)\r\n            timetables = {};\r\n    } catch (SyntaxError) {\r\n        timetables = {};\r\n    }\r\n\r\n    const timetablesBlock = document.getElementById(\"timetables-block\");\r\n    if (timetablesBlock != null && selection) {\r\n        const substitutions = {};\r\n        for (let substitutionsBox of document.getElementsByClassName(\"substitutions-box\")) {\r\n            const tableBody = substitutionsBox.querySelector(\".substitutions-table tbody\");\r\n            if (tableBody) {\r\n                const dayName = substitutionsBox.querySelector(\".day-name\").textContent;\r\n                let groupName = null;\r\n                let groupSubstitutions = [{}, {}, {}, {}, {}, {}, {}, {}, {}, {}];\r\n                function newGroupSubstitutions() {\r\n                    let groupLetterPart;\r\n                    let groupNumberPart;\r\n                    const affectedGroups = [];\r\n                    let match = groupName.match(/^(\\d+)([A-Za-z]*)$/);\r\n                    if (match != null) {\r\n                        groupNumberPart = match[1];\r\n                        groupLetterPart = match[2];\r\n                    } else {\r\n                        groupNumberPart = \"\";\r\n                        groupLetterPart = groupName;\r\n                    }\r\n                    if (groupNumberPart !== \"\") {\r\n                        if (groupLetterPart !== \"\") {\r\n                            for (let letter of groupLetterPart) {\r\n                                affectedGroups.push(groupNumberPart + letter);\r\n                            }\r\n                        } else {\r\n                            affectedGroups.push(groupNumberPart);\r\n                        }\r\n                    } else {\r\n                        affectedGroups.push(groupLetterPart);\r\n                    }\r\n                    let matchingSelections = [];\r\n                    for (let s of selection.split(\", \")) {\r\n                        for (let g of affectedGroups) {\r\n                            if (g.includes(s)) {\r\n                                matchingSelections.push(s);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    console.log(groupName, affectedGroups, matchingSelections);\r\n                    for (let s of matchingSelections) {\r\n                        if (!(s in substitutions)) {\r\n                            substitutions[s] = {};\r\n                        }\r\n                        if (dayName in substitutions[s]) {\r\n                            for (let l = 0; l<10; l++) {\r\n                                substitutions[s][dayName][l] = Object.assign(substitutions[s][dayName][l], groupSubstitutions[l]);\r\n                            }\r\n                        } else {\r\n                            substitutions[s][dayName] = groupSubstitutions;\r\n                        }\r\n                    }\r\n                }\r\n                for (let row of tableBody.children) {\r\n                    let groupNameCell = row.querySelector(\".group-name\");\r\n                    let teacherName;\r\n                    let lessonString;\r\n                    if (groupNameCell != null) {\r\n                        if (groupName != null)\r\n                            newGroupSubstitutions();\r\n                        groupSubstitutions = [{}, {}, {}, {}, {}, {}, {}, {}, {}, {}];\r\n                        groupName = groupNameCell.textContent;\r\n                        teacherName = row.children[1].textContent.toUpperCase();\r\n                        lessonString = row.children[3].textContent;\r\n                    } else {\r\n                        teacherName = row.children[0].textContent.toUpperCase();\r\n                        lessonString = row.children[2].textContent;\r\n                    }\r\n                    for (let lesson of lessonString.match(/(\\d+)/g)) {\r\n                        lesson = parseInt(lesson);\r\n                        if (teacherName in groupSubstitutions[lesson-1])\r\n                            groupSubstitutions[lesson-1][teacherName].push(row);\r\n                        else\r\n                            groupSubstitutions[lesson-1][teacherName] = [row];\r\n                    }\r\n                }\r\n                if (groupName != null)\r\n                    newGroupSubstitutions();\r\n            }\r\n        }\r\n        console.log(substitutions);\r\n\r\n        const timetablesBlockTemplate = document.getElementById(\"timetables-block-template\");\r\n        const timetableTemplate = document.getElementById(\"timetable-template\");\r\n        timetablesBlock.appendChild(timetablesBlockTemplate.content);\r\n        const timetablesContainer = document.getElementById(\"timetables-container\");\r\n        function setRelevant(input, value = null, markRelevant = true) {\r\n            if (!value)\r\n                value = input.value;\r\n            let selection = input.dataset.selection;\r\n            if (selection in substitutions) {\r\n                let s = substitutions[selection];\r\n                let weekdayName = input.dataset.weekdayName;\r\n                if (weekdayName in s) {\r\n                    let teacher = value.toUpperCase();\r\n                    s = s[weekdayName][input.dataset.lesson-1];\r\n                    if (teacher in s) {\r\n                        for (let row of s[teacher]) {\r\n                            if (markRelevant)\r\n                                row.classList.add(\"is-relevant\");\r\n                            else\r\n                                row.classList.remove(\"is-relevant\");\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let s of selection.split(\", \")) {\r\n            if (!(s in timetables)) {\r\n                timetables[s] = [\r\n                    [null, null, null, null, null, null, null, null, null, null],\r\n                    [null, null, null, null, null, null, null, null, null, null],\r\n                    [null, null, null, null, null, null, null, null, null, null],\r\n                    [null, null, null, null, null, null, null, null, null, null],\r\n                    [null, null, null, null, null, null, null, null, null, null],\r\n                ];\r\n            }\r\n            const timetable = timetableTemplate.content.firstElementChild.cloneNode(true);\r\n            timetablesContainer.appendChild(timetable);\r\n            timetable.querySelector(\".timetable-selection\").innerText = s;\r\n            const tbody = timetable.querySelector(\"tbody\");\r\n            for (let lessonNum = 1; lessonNum < 11; lessonNum++) {\r\n                const row = document.createElement(\"tr\");\r\n                tbody.appendChild(row);\r\n                const th = document.createElement(\"th\");\r\n                row.appendChild(th);\r\n                th.innerText = lessonNum + \".\";\r\n                for (let weekday = 0; weekday < 5; weekday++) {\r\n                    const cell = document.createElement(\"td\");\r\n                    row.appendChild(cell);\r\n                    const input = document.createElement(\"input\");\r\n                    cell.appendChild(input);\r\n                    input.classList.add(\"form-control\", \"form-control-sm\");\r\n                    input.id = s + \"-\" + weekday + \"-\" + lessonNum;\r\n                    const weekdayName = [\"Montag\", \"Dienstag\", \"Mittwoch\", \"Donnerstag\", \"Freitag\"][weekday];\r\n                    input.setAttribute(\"type\", \"text\");\r\n                    input.setAttribute(\"maxlength\", \"3\");\r\n                    input.setAttribute(\"aria-label\", `${lessonNum}. Stunde ${weekdayName}`);\r\n                    input.addEventListener(\"focus\", e => e.target.select());\r\n                    input.addEventListener(\"input\", e => {\r\n                        // noinspection JSUnresolvedVariable\r\n                        setRelevant(e.target, e.target.dataset.oldvalue, false);\r\n                        // noinspection JSUnresolvedVariable\r\n                        setRelevant(e.target);\r\n                        // noinspection JSUnresolvedVariable\r\n                        timetables[e.target.dataset.selection]\r\n                            [parseInt(e.target.dataset.weekday)]\r\n                            [parseInt(e.target.dataset.lesson)-1] = e.target.value.toUpperCase();\r\n                        window.localStorage.setItem(substitutionPlanType + \"-timetables\", JSON.stringify(timetables));\r\n                    });\r\n                    input.dataset.selection = s;\r\n                    input.dataset.weekday = weekday;\r\n                    input.dataset.weekdayName = weekdayName;\r\n                    input.dataset.lesson = lessonNum;\r\n                    let teacher = timetables[s][weekday][lessonNum-1];\r\n                    if (teacher != null) {\r\n                        input.value = teacher;\r\n                        input.dataset.oldvalue = teacher;\r\n                        setRelevant(input);\r\n                    } else {\r\n                        input.dataset.oldvalue = \"\";\r\n                    }\r\n                }\r\n\r\n                function focusNextLesson(currentInput, direction) {\r\n                    let weekday = parseInt(currentInput.dataset.weekday);\r\n                    let lesson = parseInt(currentInput.dataset.lesson);\r\n                    lesson += direction;\r\n                    if (lesson < 1) {\r\n                        weekday--;\r\n                        if (weekday < 0)\r\n                            return false;\r\n                        lesson = 10;\r\n                    } else if (lesson > 10) {\r\n                        weekday++;\r\n                        if (weekday >= 5)\r\n                            return false;\r\n                        lesson = 1;\r\n                    }\r\n                    document.getElementById(currentInput.dataset.selection + \"-\" + weekday + \"-\" + lesson).focus();\r\n                    return true;\r\n                }\r\n\r\n                function focusNextWeekday(currentInput, direction) {\r\n                    let weekday = parseInt(currentInput.dataset.weekday);\r\n                    let lesson = parseInt(currentInput.dataset.lesson);\r\n                    weekday += direction;\r\n                    if (0 <= weekday && weekday <= 4) {\r\n                        document.getElementById(currentInput.dataset.selection + \"-\" + weekday + \"-\" + lesson).focus();\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                }\r\n\r\n                tbody.addEventListener(\"keydown\", e => {\r\n                    switch (e.key) {\r\n                        case \"Tab\":\r\n                            if (focusNextLesson(e.target, e.shiftKey ? -1 : 1))\r\n                                e.preventDefault();\r\n                            break;\r\n                        case \"ArrowDown\":\r\n                            if (focusNextLesson(e.target, 1))\r\n                                e.preventDefault();\r\n                            break;\r\n                        case \"ArrowUp\":\r\n                            if (focusNextLesson(e.target, -1))\r\n                                e.preventDefault();\r\n                            break;\r\n                        case \"ArrowLeft\":\r\n                            // noinspection JSUnresolvedVariable\r\n                            if (e.target.selectionStart === 0 &&\r\n                                (e.target.selectionEnd === 1 || e.target.selectionEnd === 0))\r\n                                if (focusNextWeekday(e.target, -1))\r\n                                    e.preventDefault();\r\n                            break;\r\n                        case \"ArrowRight\":\r\n                            // noinspection JSUnresolvedVariable\r\n                            if (e.target.selectionStart === e.target.selectionEnd)\r\n                                if (focusNextWeekday(e.target, 1))\r\n                                    e.preventDefault();\r\n                            break;\r\n                    }\r\n                });\r\n                tbody.addEventListener(\"input\", e => {\r\n                    // noinspection JSUnresolvedVariable\r\n                    if (e.target.value.length >= e.target.maxLength) {\r\n                        focusNextLesson(e.target, 1);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n} catch (e) {\r\n    console.error(e);\r\n}\r\n"]}