{"version":3,"sources":["assets/static/assets/js/substitutions.js"],"names":["greySubstitutions","now","Date","dates","length","innerHTML","getDate","getMonth","getFullYear","b2","getHours","c2","getMinutes","i","x","document","getElementsByClassName","classList","add","setTimeout","getTime","e","console","error","substitutionPlanType","window","location","pathname","split","toggleNotifications","getElementById","notificationsInfo","notificationsInfo_none","notificationsInfo_all","notificationsInfo_selection","notificationsInfo_blocked","notificationsInfo_failed","base64UrlToUint8Array","base64UrlData","padding","repeat","base64","replace","rawData","atob","buffer","Uint8Array","charCodeAt","subscribePush","isActive","registration","Promise","resolve","reject","pushManager","subscribe","userVisibleOnly","applicationServerKey","then","subscription","log","fetch","origin","method","body","JSON","stringify","toJSON","selection","is_active","response","json","data","ok","catch","reason","notificationState","setNotificationsInfo","state","localStorage","setItem","checked","disabled","onNotificationsAvailable","reloadPermissionState","startsWith","Notification","permission","hidden","addEventListener","requestPermission","getItem","navigator","serviceWorker","ready","active","warn","register","updateWebSocket","webSocket","readyState","OPEN","send","type","status","textContent","createWebSocket","openCallback","WebSocket","protocol","host","event","onOnline","onOffline","msg","parse","reload","onlineStatus","remove","close","value","timetables","SyntaxError","timetablesBlock","setRelevant","input","markRelevant","dataset","substitutions","s","weekdayName","teacher","toUpperCase","lesson","row","substitutionsBox","tableBody","querySelector","newGroupSubstitutions","affectedGroups","match","groupName","groupNumberPart","groupLetterPart","letter","push","matchingSelections","g","includes","dayName","l","Object","assign","groupSubstitutions","children","groupNameCell","teacherName","lessonString","parseInt","timetablesBlockTemplate","timetableTemplate","appendChild","content","timetablesContainer","sUpper","timetable","firstElementChild","cloneNode","innerText","tbody","lessonNum","focusNextWeekday","currentInput","direction","weekday","focus","focusNextLesson","blur","createElement","th","cell","id","setAttribute","target","select","oldvalue","key","shiftKey","preventDefault","selectionStart","selectionEnd","maxLength"],"mappings":"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","file":"substitutions.min.js","sourcesContent":["// ==================\n// GREY SUBSTITUTIONS\ntry {\n    const dates = document.getElementsByClassName(\"date\");\n\n    function greySubstitutions() {\n        const now = new Date();\n        if (dates.length > 0 && dates[0].innerHTML === now.getDate() + \".\" + (now.getMonth() + 1) + \".\" + now.getFullYear()) {\n            const b2 = now.getHours();\n            const c2 = now.getMinutes();\n            for (let i of [\n                [\"1\", 8, 35],\n                [\"2\", 9, 25],\n                [\"3\", 10, 30],\n                [\"4\", 11, 15],\n                [\"5\", 12, 20],\n                [\"6\", 13, 10],\n                [\"7\", 14, 35],\n                [\"8\", 15, 25],\n                [\"9\", 16, 20],\n                [\"10\", 17, 5]\n            ]) {\n                if (i[1] < b2 || (i[1] === b2 && i[2] <= c2)) {\n                    for (let x of document.getElementsByClassName(\"lesson\" + i[0])) {\n                        x.classList.add(\"grey\");\n                    }\n                } else {\n                    // noinspection JSCheckFunctionSignatures\n                    setTimeout(greySubstitutions, new Date(now.getFullYear(), now.getMonth(), now.getDate(), i[1], i[2]).getTime() - now.getTime());\n                    break\n                }\n            }\n        }\n    }\n\n    greySubstitutions();\n} catch (e) {\n    console.error(e);\n}\nlet substitutionPlanType = window.location.pathname.split(\"/\", 2)[1];\n\n\n// ============\n// PUSH NOTIFICATIONS\n\nconst toggleNotifications = document.getElementById(\"toggle-notifications\");\nconst notificationsInfo = document.getElementById(\"notifications-info\");\nconst notificationsInfo_none = document.getElementById(\"notifications-info-none\");\nconst notificationsInfo_all = document.getElementById(\"notifications-info-all\");\nconst notificationsInfo_selection = document.getElementById(\"notifications-info-selection\");\nconst notificationsInfo_blocked = document.getElementById(\"notifications-info-blocked\");\nconst notificationsInfo_failed = document.getElementById(\"notifications-info-failed\");\n\nfunction base64UrlToUint8Array(base64UrlData) {\n    const padding = '='.repeat((4 - base64UrlData.length % 4) % 4);\n    const base64 = (base64UrlData + padding)\n        .replace(/-/g, '+')\n        .replace(/_/g, '/');\n\n    const rawData = atob(base64);\n    const buffer = new Uint8Array(rawData.length);\n\n    for (let i = 0; i < rawData.length; ++i) {\n        buffer[i] = rawData.charCodeAt(i);\n    }\n\n    return buffer;\n}\n\nfunction subscribePush(isActive, registration) {\n    return new Promise((resolve, reject) => {\n        registration.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: base64UrlToUint8Array(\"BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8\")\n        }).then(subscription => {\n            console.log(\"Got push subscription:\", subscription, isActive ? \"(active)\" : \"(not active)\");\n            fetch(window.location.origin + window.location.pathname + \"api/subscribe-push\", {\n                method: \"post\",\n                \"headers\": {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({subscription: subscription.toJSON(), selection: selection, is_active: isActive})\n            })\n                .then(response => response.json())\n                .then(data => {\n                    if (data.ok) {\n                        console.log(\"Push subscription successful\");\n                        resolve();\n                    } else {\n                        console.error(\"Push subscription failed\", data);\n                        reject();\n                    }\n                });\n        }).catch(reason => {\n            console.error(\"Push subscription failed\", reason);\n            reject(reason);\n        });\n    });\n}\n\n\nlet notificationState;\n\nfunction setNotificationsInfo(state, registration) {\n    console.log(\"Setting notification-state to\", state);\n    notificationState = state;\n    window.localStorage.setItem(substitutionPlanType + \"-notification-state\", notificationState);\n    switch (notificationState) {\n        case \"granted-and-enabled\":\n            toggleNotifications.checked = true;\n            toggleNotifications.disabled = false;\n            if (selection !== \"\") {\n                notificationsInfo.innerHTML = notificationsInfo_selection.innerHTML.replace(\"{selection}\", selection);\n            } else {\n                notificationsInfo.innerHTML = notificationsInfo_all.innerHTML;\n            }\n            subscribePush(true, registration)\n                .catch(reason => {\n                    console.error(\"Push subscription failed\", reason);\n                    setNotificationsInfo(\"failed\", registration);\n                });\n            break;\n        case \"denied\":\n            toggleNotifications.checked = false;\n            toggleNotifications.disabled = true;\n            notificationsInfo.innerHTML = notificationsInfo_blocked.innerHTML;\n            break;\n        case \"failed\":\n            toggleNotifications.checked = false;\n            toggleNotifications.disabled = true;\n            notificationsInfo.innerHTML = notificationsInfo_failed.innerHTML;\n            break;\n        case \"granted-and-disabled\":\n            subscribePush(false, registration)\n                .catch(reason => {\n                    console.error(\"Push subscription failed\", reason);\n                    setNotificationsInfo(\"failed\", registration);\n                });\n            toggleNotifications.checked = false;\n            toggleNotifications.disabled = false;\n            notificationsInfo.innerHTML = notificationsInfo_none.innerHTML;\n            break;\n        default:\n        case \"default\":\n            toggleNotifications.checked = false;\n            toggleNotifications.disabled = false;\n            notificationsInfo.innerHTML = notificationsInfo_none.innerHTML;\n            break;\n    }\n}\n\nfunction onNotificationsAvailable(registration) {\n    document.getElementById(\"notifications-not-available-alert\").hidden = true;\n    document.getElementById(\"toggle-notifications-wrapper\").hidden = false;\n    toggleNotifications.addEventListener(\"change\", () => {\n        if (toggleNotifications.checked) {\n            window.Notification.requestPermission()\n                .then(permission => {\n                    switch (permission) {\n                        case \"granted\":\n                            notificationState = \"granted-and-enabled\";\n                            break;\n                        default:\n                            notificationState = permission;\n                    }\n                    setNotificationsInfo(notificationState, registration);\n                });\n        } else {\n            if (notificationState === \"granted-and-enabled\") {\n                setNotificationsInfo(\"granted-and-disabled\", registration);\n            }\n        }\n    });\n\n    function reloadPermissionState() {\n        if (!notificationState.startsWith(Notification.permission)) {\n            // permission has been changed\n            if (Notification.permission === \"granted\") {\n                setNotificationsInfo(\"granted-and-disabled\", registration);\n            } else {\n                setNotificationsInfo(Notification.permission, registration);\n            }\n            return true;\n        }\n        return false;\n    }\n    window.addEventListener(\"focus\", reloadPermissionState);\n\n    notificationState = window.localStorage.getItem(substitutionPlanType + \"-notification-state\");\n    if (notificationState == null)\n        notificationState = \"default\";\n    if (!reloadPermissionState()) {\n        setNotificationsInfo(notificationState, registration);\n    }\n}\n\nif (\"serviceWorker\" in navigator) {\n    window.addEventListener(\"load\", () => {\n        navigator.serviceWorker.ready\n            .then(registration => {\n                console.log(\"ServiceWorker is active:\", registration.active);\n                if (!(\"Notification\" in window)) {\n                    console.warn(\"Notification is not supported\");\n                    return;\n                }\n                if (!(\"localStorage\" in window)) {\n                    console.warn(\"localStorage is not supported\");\n                    return;\n                }\n                if (!(\"PushManager\" in window)) {\n                    console.warn(\"PushManager is not supported\");\n                    return;\n                }\n                onNotificationsAvailable(registration);\n            });\n        navigator.serviceWorker.register(\"/sw.min.js\")\n            .then(registration => {\n                console.log(\"ServiceWorker registration successful:\", registration);\n            }).catch(reason => console.warn(\"ServiceWorker registration failed:\", reason))\n    });\n} else {\n    console.warn(\"serviceWorker is not supported\");\n}\n\n\n// =================\n// WEBSOCKET UPDATES\n\ntry {\n    const onlineStatus = document.getElementById(\"online-status\");\n\n    let webSocket = null;\n    function onOnline() {\n        onlineStatus.textContent = \"Aktuell\";\n        onlineStatus.classList.add(\"online\");\n        onlineStatus.classList.remove(\"offline\");\n    }\n    function onOffline() {\n        onlineStatus.textContent = \"Keine Verbindung zum Server\";\n        onlineStatus.classList.add(\"offline\");\n        onlineStatus.classList.remove(\"online\");\n    }\n    function createWebSocket(openCallback=null) {\n        webSocket = new WebSocket(\n            (window.location.protocol === \"http:\" ? \"ws:\" : \"wss:\") + \"//\" +\n            window.location.host + window.location.pathname + \"api/wait-for-updates\");\n\n        webSocket.addEventListener(\"open\", event => {\n            console.log(\"WebSocket opened\", event);\n            onOnline();\n            if (openCallback)\n                openCallback();\n        });\n        webSocket.addEventListener(\"close\", event => {\n            console.log(\"WebSocket closed\", event);\n            onOffline();\n        });\n        webSocket.addEventListener(\"message\", event => {\n            const msg = JSON.parse(event.data);\n            console.log(\"WebSocket message\", msg);\n            switch (msg.type) {\n                /*case \"heartbeat\":\n                    clearTimeout(disconnectTimeout);\n                    break;*/\n                case \"new_substitutions\":\n                    window.location.reload();\n                    break;\n                default:\n                    console.warn(\"Unknown WebSocket message type\");\n                    break;\n            }\n        });\n    }\n    createWebSocket();\n\n    function updateWebSocket() {\n        // Send status to server. The server checks whether the status is still up-to-date. If not, it sends a\n        // message, and thus the page is reloaded.\n        if (webSocket.readyState === webSocket.OPEN) {\n            webSocket.send(JSON.stringify({type: \"check_status\", status: document.getElementById(\"status\").textContent}));\n        } else {\n            createWebSocket(() => webSocket.send(JSON.stringify({type: \"check_status\", status: document.getElementById(\"status\").textContent})));\n        }\n    }\n\n    window.addEventListener(\"focus\", () => {\n        console.log(\"focus, checking for new substitutions\");\n        updateWebSocket();\n    });\n\n    window.addEventListener(\"online\", () => {\n        console.log(\"online, checking for new substitutions\");\n        updateWebSocket();\n    });\n    window.addEventListener(\"offline\", () => {\n        console.log(\"offline, closing WebSocket connection\");\n        onOffline();\n        webSocket.close();\n    });\n} catch (e) {\n    console.error(e);\n}\n\n\n// =================\n// TIMETABLES\n\nconst selection = document.getElementById(\"selectionInput\").value;\n\ntry {\n    let timetables;\n    try {\n        timetables = JSON.parse(window.localStorage.getItem(substitutionPlanType + \"-timetables\"));\n        if (!timetables)\n            timetables = {};\n    } catch (SyntaxError) {\n        timetables = {};\n    }\n\n    const timetablesBlock = document.getElementById(\"timetables-block\");\n    if (timetablesBlock != null && selection) {\n        const substitutions = {};\n        for (let substitutionsBox of document.getElementsByClassName(\"substitutions-box\")) {\n            const tableBody = substitutionsBox.querySelector(\".substitutions-table tbody\");\n            if (tableBody) {\n                const dayName = substitutionsBox.querySelector(\".day-name\").textContent;\n                let groupName = null;\n                let groupSubstitutions = [{}, {}, {}, {}, {}, {}, {}, {}, {}, {}];\n                function newGroupSubstitutions() {\n                    let groupLetterPart;\n                    let groupNumberPart;\n                    const affectedGroups = [];\n                    let match = groupName.match(/^(\\d+)([A-Za-z]*)$/);\n                    if (match != null) {\n                        groupNumberPart = match[1];\n                        groupLetterPart = match[2].toUpperCase();\n                    } else {\n                        groupNumberPart = \"\";\n                        groupLetterPart = groupName.toUpperCase();\n                    }\n                    if (groupNumberPart !== \"\") {\n                        if (groupLetterPart !== \"\") {\n                            for (let letter of groupLetterPart) {\n                                affectedGroups.push(groupNumberPart + letter);\n                            }\n                        } else {\n                            affectedGroups.push(groupNumberPart);\n                        }\n                    } else {\n                        affectedGroups.push(groupLetterPart);\n                    }\n                    let matchingSelections = [];\n                    for (let s of selection.split(\", \")) {\n                        s = s.toUpperCase();\n                        for (let g of affectedGroups) {\n                            if (g.includes(s)) {\n                                matchingSelections.push(s);\n                                break;\n                            }\n                        }\n                    }\n                    console.log(groupName, affectedGroups, matchingSelections);\n                    for (let s of matchingSelections) {\n                        if (!(s in substitutions)) {\n                            substitutions[s] = {};\n                        }\n                        if (dayName in substitutions[s]) {\n                            for (let l = 0; l<10; l++) {\n                                substitutions[s][dayName][l] = Object.assign(substitutions[s][dayName][l], groupSubstitutions[l]);\n                            }\n                        } else {\n                            substitutions[s][dayName] = groupSubstitutions;\n                        }\n                    }\n                }\n                for (let row of tableBody.children) {\n                    let groupNameCell = row.querySelector(\".group-name\");\n                    let teacherName;\n                    let lessonString;\n                    if (groupNameCell != null) {\n                        if (groupName != null)\n                            newGroupSubstitutions();\n                        groupSubstitutions = [{}, {}, {}, {}, {}, {}, {}, {}, {}, {}];\n                        groupName = groupNameCell.textContent;\n                        teacherName = row.children[1].textContent.toUpperCase();\n                        lessonString = row.children[3].textContent;\n                    } else {\n                        teacherName = row.children[0].textContent.toUpperCase();\n                        lessonString = row.children[2].textContent;\n                    }\n                    for (let lesson of lessonString.match(/(\\d+)/g)) {\n                        lesson = parseInt(lesson);\n                        if (teacherName in groupSubstitutions[lesson-1])\n                            groupSubstitutions[lesson-1][teacherName].push(row);\n                        else\n                            groupSubstitutions[lesson-1][teacherName] = [row];\n                    }\n                }\n                if (groupName != null)\n                    newGroupSubstitutions();\n            }\n        }\n        console.log(substitutions);\n\n        const timetablesBlockTemplate = document.getElementById(\"timetables-block-template\");\n        const timetableTemplate = document.getElementById(\"timetable-template\");\n        timetablesBlock.appendChild(timetablesBlockTemplate.content);\n        const timetablesContainer = document.getElementById(\"timetables-container\");\n        function setRelevant(input, value = null, markRelevant = true) {\n            if (!value)\n                value = input.value;\n            let selection = input.dataset.selection;\n            if (selection in substitutions) {\n                let s = substitutions[selection];\n                let weekdayName = input.dataset.weekdayName;\n                if (weekdayName in s) {\n                    let teacher = value.toUpperCase();\n                    s = s[weekdayName][input.dataset.lesson-1];\n                    if (teacher in s) {\n                        for (let row of s[teacher]) {\n                            if (markRelevant)\n                                row.classList.add(\"is-relevant\");\n                            else\n                                row.classList.remove(\"is-relevant\");\n                        }\n                    }\n                }\n            }\n        }\n        for (let s of selection.split(\", \")) {\n            let sUpper = s.toUpperCase();\n            if (!(sUpper in timetables)) {\n                timetables[sUpper] = [\n                    [null, null, null, null, null, null, null, null, null, null],\n                    [null, null, null, null, null, null, null, null, null, null],\n                    [null, null, null, null, null, null, null, null, null, null],\n                    [null, null, null, null, null, null, null, null, null, null],\n                    [null, null, null, null, null, null, null, null, null, null],\n                ];\n            }\n            const timetable = timetableTemplate.content.firstElementChild.cloneNode(true);\n            timetablesContainer.appendChild(timetable);\n            timetable.querySelector(\".timetable-selection\").innerText = s;\n            const tbody = timetable.querySelector(\"tbody\");\n            for (let lessonNum = 1; lessonNum < 11; lessonNum++) {\n                const row = document.createElement(\"tr\");\n                tbody.appendChild(row);\n                const th = document.createElement(\"th\");\n                row.appendChild(th);\n                th.innerText = lessonNum + \".\";\n                for (let weekday = 0; weekday < 5; weekday++) {\n                    const cell = document.createElement(\"td\");\n                    row.appendChild(cell);\n                    const input = document.createElement(\"input\");\n                    cell.appendChild(input);\n                    input.classList.add(\"form-control\", \"form-control-sm\");\n                    input.id = \"timetable-\" + sUpper + \"-\" + weekday + \"-\" + lessonNum;\n                    const weekdayName = [\"Montag\", \"Dienstag\", \"Mittwoch\", \"Donnerstag\", \"Freitag\"][weekday];\n                    input.setAttribute(\"type\", \"text\");\n                    input.setAttribute(\"autocapitalize\", \"characters\");\n                    input.setAttribute(\"autocomplete\", \"off\");\n                    input.setAttribute(\"autocorrect\", \"off\");\n                    input.setAttribute(\"spellcheck\", \"false\");\n                    input.setAttribute(\"enterkeyhint\", weekday === 4 && lessonNum === 10 ? \"done\" : \"next\");\n                    input.setAttribute(\"maxlength\", \"3\");\n                    input.setAttribute(\"aria-label\", `${lessonNum}. Stunde ${weekdayName}`);\n                    input.addEventListener(\"focus\", e => e.target.select());\n                    input.addEventListener(\"input\", e => {\n                        // noinspection JSUnresolvedVariable\n                        setRelevant(e.target, e.target.dataset.oldvalue, false);\n                        // noinspection JSUnresolvedVariable\n                        setRelevant(e.target);\n                        // noinspection JSUnresolvedVariable\n                        e.target.dataset.oldvalue = e.target.value;\n                        // noinspection JSUnresolvedVariable\n                        timetables[e.target.dataset.selection]\n                            [parseInt(e.target.dataset.weekday)]\n                            [parseInt(e.target.dataset.lesson)-1] = e.target.value.toUpperCase();\n                        window.localStorage.setItem(substitutionPlanType + \"-timetables\", JSON.stringify(timetables));\n                    });\n                    input.dataset.selection = sUpper;\n                    input.dataset.weekday = weekday;\n                    input.dataset.weekdayName = weekdayName;\n                    input.dataset.lesson = lessonNum;\n                    let teacher = timetables[sUpper][weekday][lessonNum-1];\n                    if (teacher != null) {\n                        input.value = teacher;\n                        input.dataset.oldvalue = teacher;\n                        setRelevant(input);\n                    } else {\n                        input.dataset.oldvalue = \"\";\n                    }\n                }\n\n                function focusNextLesson(currentInput, direction) {\n                    let weekday = parseInt(currentInput.dataset.weekday);\n                    let lesson = parseInt(currentInput.dataset.lesson);\n                    lesson += direction;\n                    if (lesson < 1) {\n                        weekday--;\n                        if (weekday < 0)\n                            return false;\n                        lesson = 10;\n                    } else if (lesson > 10) {\n                        weekday++;\n                        if (weekday >= 5) {\n                            currentInput.blur();\n                            return false;\n                        }\n                        lesson = 1;\n                    }\n                    document.getElementById(\"timetable-\" + currentInput.dataset.selection + \"-\" + weekday + \"-\" + lesson).focus();\n                    return true;\n                }\n\n                function focusNextWeekday(currentInput, direction) {\n                    let weekday = parseInt(currentInput.dataset.weekday);\n                    let lesson = parseInt(currentInput.dataset.lesson);\n                    weekday += direction;\n                    if (0 <= weekday && weekday <= 4) {\n                        document.getElementById(\"timetable-\" + currentInput.dataset.selection + \"-\" + weekday + \"-\" + lesson).focus();\n                        return true;\n                    }\n                    return false;\n                }\n\n                tbody.addEventListener(\"keydown\", e => {\n                    switch (e.key) {\n                        case \"Tab\":\n                        case \"Enter\":\n                            if (focusNextLesson(e.target, e.shiftKey ? -1 : 1))\n                                e.preventDefault();\n                            break;\n                        case \"ArrowDown\":\n                            if (focusNextLesson(e.target, 1))\n                                e.preventDefault();\n                            break;\n                        case \"ArrowUp\":\n                            if (focusNextLesson(e.target, -1))\n                                e.preventDefault();\n                            break;\n                        case \"ArrowLeft\":\n                            // noinspection JSUnresolvedVariable\n                            if (e.target.selectionStart === 0 &&\n                                (e.target.selectionEnd === 1 || e.target.selectionEnd === 0))\n                                if (focusNextWeekday(e.target, -1))\n                                    e.preventDefault();\n                            break;\n                        case \"ArrowRight\":\n                            // noinspection JSUnresolvedVariable\n                            if (e.target.selectionStart === e.target.selectionEnd)\n                                if (focusNextWeekday(e.target, 1))\n                                    e.preventDefault();\n                            break;\n                    }\n                });\n                tbody.addEventListener(\"input\", e => {\n                    // noinspection JSUnresolvedVariable\n                    if (e.target.value.length >= e.target.maxLength) {\n                        focusNextLesson(e.target, 1);\n                    }\n                });\n            }\n        }\n    }\n} catch (e) {\n    console.error(e);\n}\n"]}