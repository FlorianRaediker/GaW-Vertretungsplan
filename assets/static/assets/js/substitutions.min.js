'use strict';try{var q=function(){const d=new Date;if(0<b.length&&b[0].innerHTML===d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()){const e=d.getHours(),l=d.getMinutes();for(let n of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(n[1]<e||n[1]===e&&n[2]<=l)for(let x of document.getElementsByClassName("lesson"+n[0]))x.classList.add("grey");else{setTimeout(q,(new Date(d.getFullYear(),d.getMonth(),d.getDate(),n[1],n[2])).getTime()-
d.getTime());break}}};const b=document.getElementsByClassName("date");q()}catch(b){console.error(b)}let r=window.location.pathname.split("/",2)[1];const y=document.getElementById("toggle-notifications"),z=document.getElementById("notifications-info"),A=document.getElementById("notifications-info-none"),B=document.getElementById("notifications-info-all"),C=document.getElementById("notifications-info-selection"),D=document.getElementById("notifications-info-blocked"),F=document.getElementById("notifications-info-failed");
function G(b){var d="=".repeat((4-b.length%4)%4);b=(b+d).replace(/-/g,"+").replace(/_/g,"/");b=atob(b);d=new Uint8Array(b.length);for(let e=0;e<b.length;++e)d[e]=b.charCodeAt(e);return d}
function H(b,d){return new Promise((e,l)=>{d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:G("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(n=>{console.log("Got push subscription:",n,b?"(active)":"(not active)");fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:n.toJSON(),selection:I,is_active:b})}).then(x=>x.json()).then(x=>
{x.ok?(console.log("Push subscription successful"),e()):(console.error("Push subscription failed",x),l())})}).catch(n=>{console.error("Push subscription failed",n);l(n)})})}let J;
function K(b,d){console.log("Setting notification-state to",b);J=b;window.localStorage.setItem(r+"-notification-state",J);switch(J){case "granted-and-enabled":y.checked=!0;y.disabled=!1;z.innerHTML=""!==I?C.innerHTML.replace("{selection}",I):B.innerHTML;H(!0,d).catch(e=>{console.error("Push subscription failed",e);K("failed",d)});break;case "denied":y.checked=!1;y.disabled=!0;z.innerHTML=D.innerHTML;break;case "failed":y.checked=!1;y.disabled=!0;z.innerHTML=F.innerHTML;break;case "granted-and-disabled":H(!1,
d).catch(e=>{console.error("Push subscription failed",e);K("failed",d)});y.checked=!1;y.disabled=!1;z.innerHTML=A.innerHTML;break;default:case "default":y.checked=!1,y.disabled=!1,z.innerHTML=A.innerHTML}}
function L(b){function d(){return J.startsWith(Notification.permission)?!1:("granted"===Notification.permission?K("granted-and-disabled",b):K(Notification.permission,b),!0)}document.getElementById("notifications-not-available-alert").hidden=!0;document.getElementById("toggle-notifications-wrapper").hidden=!1;y.addEventListener("change",()=>{y.checked?window.Notification.requestPermission().then(e=>{switch(e){case "granted":J="granted-and-enabled";break;default:J=e}K(J,b)}):"granted-and-enabled"===
J&&K("granted-and-disabled",b)});window.addEventListener("focus",d);J=window.localStorage.getItem(r+"-notification-state");null==J&&(J="default");d()||K(J,b)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(b=>{console.log("ServiceWorker is active:",b.active);"Notification"in window?"localStorage"in window?"PushManager"in window?L(b):console.warn("PushManager is not supported"):console.warn("localStorage is not supported"):console.warn("Notification is not supported")});navigator.serviceWorker.register("/sw.min.js").then(b=>{console.log("ServiceWorker registration successful:",b)}).catch(b=>console.warn("ServiceWorker registration failed:",
b))}):console.warn("serviceWorker is not supported");
try{var N=function(){d.readyState===d.OPEN?d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})):M(()=>d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})))},M=function(e=null){d=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");d.addEventListener("open",l=>{console.log("WebSocket opened",l);O();e&&e()});d.addEventListener("close",
l=>{console.log("WebSocket closed",l);P()});d.addEventListener("message",l=>{l=JSON.parse(l.data);console.log("WebSocket message",l);switch(l.type){case "new_substitutions":window.location.reload();break;default:console.warn("Unknown WebSocket message type")}})},P=function(){b.textContent="Keine Verbindung zum Server";b.classList.add("offline");b.classList.remove("online")},O=function(){b.textContent="Aktuell";b.classList.add("online");b.classList.remove("offline")};const b=document.getElementById("online-status");
let d=null;M();window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions");N()});window.addEventListener("online",()=>{console.log("online, checking for new substitutions");N()});window.addEventListener("offline",()=>{console.log("offline, closing WebSocket connection");P();d.close()})}catch(b){console.error(b)}const I=document.getElementById("selectionInput").value;
try{let b;try{(b=JSON.parse(window.localStorage.getItem(r+"-timetables")))||(b={})}catch(e){b={}}const d=document.getElementById("timetables-block");if(null!=d&&I){var Q=function(v,m=null,w=!0){m||(m=v.value);var h=v.dataset.selection;if(h in e){h=e[h];let k=v.dataset.weekdayName;if(k in h&&(m=m.toUpperCase(),h=h[k][v.dataset.lesson-1],m in h))for(let f of h[m])w?f.classList.add("is-relevant"):f.classList.remove("is-relevant")}};const e={};for(let v of document.getElementsByClassName("substitutions-box")){const m=
v.querySelector(".substitutions-table tbody");if(m){var R=function(){var f=[];var p=h.match(/^(\d+)([A-Za-z]*)$/);if(null!=p){var a=p[1];p=p[2].toUpperCase()}else a="",p=h.toUpperCase();if(""!==a)if(""!==p)for(let g of p)f.push(a+g);else f.push(a);else f.push(p);a=[];for(let g of I.split(", ")){g=g.toUpperCase();for(let c of f)if(c.includes(g)){a.push(g);break}}console.log(h,f,a);for(let g of a)if(g in e||(e[g]={}),w in e[g])for(f=0;10>f;f++)e[g][w][f]=Object.assign(e[g][w][f],k[f]);else e[g][w]=
k};const w=v.querySelector(".day-name").textContent;let h=null,k=[{},{},{},{},{},{},{},{},{},{}];for(let f of m.children){let p=f.querySelector(".group-name"),a,g;null!=p?(null!=h&&R(),k=[{},{},{},{},{},{},{},{},{},{}],h=p.textContent,a=f.children[1].textContent.toUpperCase(),g=f.children[3].textContent):(a=f.children[0].textContent.toUpperCase(),g=f.children[2].textContent);for(let c of g.match(/(\d+)/g))c=parseInt(c),a in k[c-1]?k[c-1][a].push(f):k[c-1][a]=[f]}null!=h&&R()}}console.log(e);const l=
document.getElementById("timetables-block-template"),n=document.getElementById("timetable-template");d.appendChild(l.content);const x=document.getElementById("timetables-container");for(let v of I.split(", ")){let m=v.toUpperCase();m in b||(b[m]=[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,
null]]);const w=n.content.firstElementChild.cloneNode(!0);x.appendChild(w);w.querySelector(".timetable-selection").innerText=v;const h=w.querySelector("tbody");for(let k=1;11>k;k++){var S=function(a,g){let c=parseInt(a.dataset.weekday),t=parseInt(a.dataset.lesson);c+=g;return 0<=c&&4>=c?(document.getElementById("timetable-"+a.dataset.selection+"-"+c+"-"+t).focus(),!0):!1},T=function(a,g){let c=parseInt(a.dataset.weekday),t=parseInt(a.dataset.lesson);t+=g;if(1>t){c--;if(0>c)return!1;t=10}else if(10<
t){c++;if(5<=c)return a.blur(),!1;t=1}document.getElementById("timetable-"+a.dataset.selection+"-"+c+"-"+t).focus();return!0};const f=document.createElement("tr");h.appendChild(f);const p=document.createElement("th");f.appendChild(p);p.innerText=k+".";for(let a=0;5>a;a++){const g=document.createElement("td");f.appendChild(g);const c=document.createElement("input");g.appendChild(c);c.classList.add("form-control","form-control-sm");c.id="timetable-"+m+"-"+a+"-"+k;const t=["Montag","Dienstag","Mittwoch",
"Donnerstag","Freitag"][a];c.setAttribute("type","text");c.setAttribute("autocapitalize","characters");c.setAttribute("autocomplete","off");c.setAttribute("autocorrect","off");c.setAttribute("spellcheck","false");c.setAttribute("enterkeyhint",4===a&&10===k?"done":"next");c.setAttribute("maxlength","3");c.setAttribute("aria-label",`${k}. Stunde ${t}`);c.addEventListener("focus",u=>u.target.select());c.addEventListener("input",u=>{Q(u.target,u.target.dataset.oldvalue,!1);Q(u.target);u.target.dataset.oldvalue=
u.target.value;b[u.target.dataset.selection][parseInt(u.target.dataset.weekday)][parseInt(u.target.dataset.lesson)-1]=u.target.value.toUpperCase();window.localStorage.setItem(r+"-timetables",JSON.stringify(b))});c.dataset.selection=m;c.dataset.weekday=a;c.dataset.weekdayName=t;c.dataset.lesson=k;let E=b[m][a][k-1];null!=E?(c.value=E,c.dataset.oldvalue=E,Q(c)):c.dataset.oldvalue=""}h.addEventListener("keydown",a=>{switch(a.key){case "Tab":case "Enter":T(a.target,a.shiftKey?-1:1)&&a.preventDefault();
break;case "ArrowDown":T(a.target,1)&&a.preventDefault();break;case "ArrowUp":T(a.target,-1)&&a.preventDefault();break;case "ArrowLeft":0!==a.target.selectionStart||1!==a.target.selectionEnd&&0!==a.target.selectionEnd||S(a.target,-1)&&a.preventDefault();break;case "ArrowRight":a.target.selectionStart===a.target.selectionEnd&&S(a.target,1)&&a.preventDefault()}});h.addEventListener("input",a=>{a.target.value.length>=a.target.maxLength&&T(a.target,1)})}}}}catch(b){console.error(b)};

//# sourceMappingURL=substitutions.min.js.map
