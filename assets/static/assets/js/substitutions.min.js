(function(){'use strict';const e=window.location.pathname.split("/",2)[1],f=document.getElementById("selectionInput").value;
if(window.location.hash.startsWith("#timetable:"))try{let [,a,b]=window.location.hash.split(":");b=atob(b);let d=!0,g;if(150!==b.length)console.warn("Timetable in URL has wrong length:",b.length,"instead of",150,b),d=!1;else{g=[];for(let c=0;5>c;c++){let n=[];g.push(n);for(let h=0;10>h;h++){let p=b.substr(30*c+3*h,3).trim();""===p&&(p=null);n.push(p)}}}if(d){let c;try{(c=JSON.parse(window.localStorage.getItem(e+"-timetables")))||(c={})}catch{c={}}a=a.toUpperCase();let n=a in c?"Die aufgerufenen URL enth\u00e4lt einen Stundenplan f\u00fcr "+
a+". Soll der aktuell gesetzte Stundenplan f\u00fcr "+a+" durch diesen ersetzt werden?":"Die aufgerufene URL enth\u00e4lt einen Stundenplan f\u00fcr "+a+". Diesen Stundenplan setzen?";if(f){let h=!1;for(let p of f.split(", "))if(p.toUpperCase()===a){h=!0;break}h||(n+=" Achtung: Der Stundenplan wird erst angewendet, wenn "+a+" auch ausgew\u00e4hlt ist.")}else n+=" Achtung: Der Stundenplan wird erst angewendet, wenn Vertretungen ausgew\u00e4hlt sind.";confirm(n)&&(c[a]=g,window.localStorage.setItem(e+
"-timetables",JSON.stringify(c)));window.location.hash=""}}catch(a){console.error("Error while retrieving timetable from URL",a),reportError(a)};const k=document.getElementsByClassName("date");
function l(){const a=new Date;if(0<k.length&&k[0].innerHTML===a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()){const b=a.getHours(),d=a.getMinutes();for(let g of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(g[1]<b||g[1]===b&&g[2]<=d)for(let c of document.getElementsByClassName("lesson"+g[0]))c.classList.add("grey");else{setTimeout(l,(new Date(a.getFullYear(),a.getMonth(),a.getDate(),g[1],g[2])).getTime()-a.getTime());
break}}}l();window.addEventListener("focus",()=>l());let m,q=document.getElementById("status").textContent;try{if(m=JSON.parse(window.localStorage.getItem(e+"-seen-substitutions")),m.status!==q){let a=Date.now();for(let b of Object.keys(m.seenSubstitutions))b<=a&&delete m.seenSubstitutions[b];for(let [b,d]of Object.entries(m.newSubstitutions))b>a&&(b in m.seenSubstitutions?m.seenSubstitutions[b].push(...d):m.seenSubstitutions[b]=d);m.newSubstitutions={};m.status=q}}catch{}m||(m={seenSubstitutions:{},newSubstitutions:{},status:q});
for(let a of document.getElementsByClassName("substitutions-box")){const b=a.querySelector(".substitutions-table tbody");if(b){const d=a.querySelector(".date").textContent.trim();let [,g,c,n]=d.match(/(\d\d?).(\d\d?).(\d\d\d\d)/);const h=Date.UTC(n,c-1,g+1);h in m.seenSubstitutions||(m.seenSubstitutions[h]=[]);h in m.newSubstitutions||(m.newSubstitutions[h]=[]);let p;for(let z of b.children){let C=z.querySelector(".group-name");null!=C&&(p=C.textContent.trim());let w=p;for(let D of z.children)D.classList.contains(".group-name")||
(w+="#"+D.textContent.trim());m.seenSubstitutions[h].includes(w)||(z.classList.add("new-subs"),m.newSubstitutions[h].includes(w)||m.newSubstitutions[h].push(w))}}}window.localStorage.setItem(e+"-seen-substitutions",JSON.stringify(m));const r=document.getElementById("toggle-notifications"),t=document.getElementById("notifications-info"),u=document.getElementById("notifications-info-none"),v=document.getElementById("notifications-info-all"),x=document.getElementById("notifications-info-selection"),y=document.getElementById("notifications-info-blocked"),A=document.getElementById("notifications-info-failed");
function B(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);b=new Uint8Array(a.length);for(let d=0;d<a.length;++d)b[d]=a.charCodeAt(d);return b}
function E(a,b){return new Promise((d,g)=>{b.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:B("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(c=>{console.log("Got push subscription:",c,a?"(active)":"(not active)");return fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:c.toJSON(),selection:f,is_active:a})})}).then(c=>
c.json()).then(c=>{c.ok?(console.log("Push subscription successful"),d()):(console.error("Push subscription failed",c),g())}).catch(c=>{console.error("Push subscription failed",c);g(c)})})}let F;
function G(a,b){console.log("Setting notification-state to",a);F=a;"failed"!==a&&localStorage.setItem(e+"-notification-state",F);localStorage.setItem(e+"-notification-state-all",F);switch(F){case "granted-and-enabled":r.checked=!0;r.disabled=!1;t.innerHTML=""!==f?x.innerHTML.replace("{selection}",f):v.innerHTML;E(!0,b).catch(d=>{console.error("Push subscription failed",d);G("failed",b)});break;case "denied":r.checked=!1;r.disabled=!0;t.innerHTML=y.innerHTML;break;case "failed":r.checked=!1;r.disabled=
!0;t.innerHTML=A.innerHTML;break;case "granted-and-disabled":E(!1,b).catch(d=>{console.error("Push subscription failed",d);G("failed",b)});r.checked=!1;r.disabled=!1;t.innerHTML=u.innerHTML;break;default:case "default":r.checked=!1,r.disabled=!1,t.innerHTML=u.innerHTML}}
function H(a){function b(){return F.startsWith(Notification.permission)||"failed"===F?!1:(console.log(F+" changed to "+Notification.permission),"granted"===Notification.permission?G("granted-and-disabled",a):G(Notification.permission,a),!0)}document.getElementById("notifications-not-available-alert").hidden=!0;document.getElementById("toggle-notifications-wrapper").hidden=!1;r.addEventListener("change",()=>{r.checked?window.Notification.requestPermission().then(d=>{switch(d){case "granted":F="granted-and-enabled";
break;default:F=d}G(F,a,!0)}):"granted-and-enabled"===F&&G("granted-and-disabled",a,!0)});window.addEventListener("focus",b);F=window.localStorage.getItem(e+"-notification-state");if(null==F||"failed"===F)F="default";b()||G(F,a)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(a=>{console.log("ServiceWorker is active:",a.active);"Notification"in window&&"localStorage"in window&&"PushManager"in window?H(a):(console.warn("Push Notifications are not supported"),F="unsupported")});navigator.serviceWorker.register("/sw.min.js").then(a=>{console.log("ServiceWorker registration successful:",a)}).catch(a=>console.warn("ServiceWorker registration failed:",a))}):(console.warn("Service Worker is not supported"),
F="unsupported");const I=document.getElementById("online-status");let J=null;function K(){I.textContent="Aktuell";I.classList.add("online");I.classList.remove("offline","updating")}function L(){I.textContent="Offline";I.classList.add("offline");I.classList.remove("online","updating")}
function M(a=null){J=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");J.addEventListener("open",b=>{console.log("WebSocket opened",b);K();a&&a(b.target)});J.addEventListener("close",b=>{console.log("WebSocket closed",b);L()});J.addEventListener("message",b=>{b=JSON.parse(b.data);console.log("WebSocket message",b);switch(b.type){case "status":(b=b.status)&&(b===document.getElementById("status").textContent?K():
window.location.reload());break;default:console.warn("Unknown WebSocket message type",b.type)}})}M();function N(){I.textContent="Aktualisiere...";I.classList.add("updating");I.classList.remove("online","offline");J.readyState===J.OPEN?J.send(JSON.stringify({type:"get_status"})):M(a=>a.send(JSON.stringify({type:"get_status"})))}window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions");N()});
window.addEventListener("online",()=>{console.log("online, checking for new substitutions");N()});window.addEventListener("offline",()=>{console.log("offline");L()});document.getElementById("themes-block").appendChild(document.getElementById("themes-block-template").content);const O=document.documentElement,P=document.getElementById("themes-system-default"),Q=document.getElementById("themes-light"),R=document.getElementById("themes-dark");
function S(a){localStorage.setItem("theme",a);switch(a){case "system-default":O.classList.remove("light","dark");break;case "light":O.classList.add("light");O.classList.remove("dark");break;case "dark":O.classList.add("dark"),O.classList.remove("light")}}switch(localStorage.getItem("theme")){case "light":Q.checked=!0;break;case "dark":R.checked=!0}P.addEventListener("change",()=>S("system-default"));Q.addEventListener("change",()=>S("light"));R.addEventListener("change",()=>S("dark"));try{let a=localStorage.getItem("theme");"system-default"!==a&&a||(a="system-"+(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));plausible("Features - "+e,{props:{Selection:f?(f.match(/,/g)||[]).length+1:0,Notifications:localStorage.getItem(e+"-notification-state-all"),Theme:a,Timetables:null}})}catch(a){console.error(a)};}).call(this);

//# sourceMappingURL=substitutions.min.js.map
