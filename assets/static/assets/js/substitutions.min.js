(function(){'use strict';function e(a,b=null){try{plausible("JavaScript Error",{props:{[(a.name||"Generic Error")+": "+((null==b?void 0:b.message)||a.message)]:((null==b?void 0:b.stack)||a.stack)+" - "+((null==b?void 0:b.filename)||a.fileName)+":"+((null==b?void 0:b.lineno)||a.lineNumber)+":"+((null==b?void 0:b.colno)||a.columnNumber)+" "+a.description+" "+a.number}})}catch(c){console.error("reporting error failed",c)}}window.addEventListener("error",a=>e(a.error,a));
window.addEventListener("unhandledrejection",a=>e(a.reason));const g=window.location.pathname.split("/",2)[1],k=document.getElementById("selectionInput").value;
if(window.location.hash.startsWith("#timetable:"))try{let [,a,b]=window.location.hash.split(":");b=atob(b);let c=!0,f;if(150!==b.length)console.warn("Timetable in URL has wrong length:",b.length,"instead of",150,b),c=!1;else{f=[];for(let d=0;5>d;d++){let n=[];f.push(n);for(let h=0;10>h;h++){let p=b.substr(30*d+3*h,3).trim();""===p&&(p=null);n.push(p)}}}if(c){let d;try{(d=JSON.parse(window.localStorage.getItem(g+"-timetables")))||(d={})}catch{d={}}a=a.toUpperCase();let n=a in d?"Die aufgerufenen URL enth\u00e4lt einen Stundenplan f\u00fcr "+
a+". Soll der aktuell gesetzte Stundenplan f\u00fcr "+a+" durch diesen ersetzt werden?":"Die aufgerufene URL enth\u00e4lt einen Stundenplan f\u00fcr "+a+". Diesen Stundenplan setzen?";if(k){let h=!1;for(let p of k.split(", "))if(p.toUpperCase()===a){h=!0;break}h||(n+=" Achtung: Der Stundenplan wird erst angewendet, wenn "+a+" auch ausgew\u00e4hlt ist.")}else n+=" Achtung: Der Stundenplan wird erst angewendet, wenn Vertretungen ausgew\u00e4hlt sind.";confirm(n)&&(d[a]=f,window.localStorage.setItem(g+
"-timetables",JSON.stringify(d)));window.location.hash=""}}catch(a){console.error("Error while retrieving timetable from URL",a),e(a)};const l=document.getElementsByClassName("date");
function m(){const a=new Date;if(0<l.length&&l[0].innerHTML===a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()){const b=a.getHours(),c=a.getMinutes();for(let f of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(f[1]<b||f[1]===b&&f[2]<=c)for(let d of document.getElementsByClassName("lesson"+f[0]))d.classList.add("grey");else{setTimeout(m,(new Date(a.getFullYear(),a.getMonth(),a.getDate(),f[1],f[2])).getTime()-a.getTime());
break}}}m();window.addEventListener("focus",()=>m());let q,r=document.getElementById("status").textContent;try{if(q=JSON.parse(window.localStorage.getItem(g+"-seen-substitutions")),q.status!==r){let a=Date.now();for(let b of Object.keys(q.seenSubstitutions))b<=a&&delete q.seenSubstitutions[b];for(let [b,c]of Object.entries(q.newSubstitutions))b>a&&(b in q.seenSubstitutions?q.seenSubstitutions[b].push(...c):q.seenSubstitutions[b]=c);q.newSubstitutions={};q.status=r}}catch{}q||(q={seenSubstitutions:{},newSubstitutions:{},status:r});
for(let a of document.getElementsByClassName("substitutions-box")){const b=a.querySelector(".substitutions-table tbody");if(b){const c=a.querySelector(".date").textContent.trim();let [,f,d,n]=c.match(/(\d\d?).(\d\d?).(\d\d\d\d)/);const h=Date.UTC(n,d-1,f+1);h in q.seenSubstitutions||(q.seenSubstitutions[h]=[]);h in q.newSubstitutions||(q.newSubstitutions[h]=[]);let p;for(let A of b.children){let D=A.querySelector(".group-name");null!=D&&(p=D.textContent.trim());let w=p;for(let E of A.children)E.classList.contains(".group-name")||
(w+="#"+E.textContent.trim());q.seenSubstitutions[h].includes(w)||(A.classList.add("new-subs"),q.newSubstitutions[h].includes(w)||q.newSubstitutions[h].push(w))}}}window.localStorage.setItem(g+"-seen-substitutions",JSON.stringify(q));const t=document.getElementById("toggle-notifications"),u=document.getElementById("notifications-info"),v=document.getElementById("notifications-info-none"),x=document.getElementById("notifications-info-all"),y=document.getElementById("notifications-info-selection"),z=document.getElementById("notifications-info-blocked"),B=document.getElementById("notifications-info-failed");
function C(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);b=new Uint8Array(a.length);for(let c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}
function F(a,b){return new Promise((c,f)=>{b.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:C("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(d=>{console.log("Got push subscription:",d,a?"(active)":"(not active)");return fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:d.toJSON(),selection:k,is_active:a})})}).then(d=>
d.json()).then(d=>{d.ok?(console.log("Push subscription successful"),c()):(console.error("Push subscription failed",d),f())}).catch(d=>{console.error("Push subscription failed",d);f(d)})})}let G;
function H(a,b){console.log("Setting notification-state to",a);G=a;"failed"!==a&&localStorage.setItem(g+"-notification-state",G);localStorage.setItem(g+"-notification-state-all",G);switch(G){case "granted-and-enabled":t.checked=!0;t.disabled=!1;u.innerHTML=""!==k?y.innerHTML.replace("{selection}",k):x.innerHTML;F(!0,b).catch(c=>{console.error("Push subscription failed",c);H("failed",b)});break;case "denied":t.checked=!1;t.disabled=!0;u.innerHTML=z.innerHTML;break;case "failed":t.checked=!1;t.disabled=
!0;u.innerHTML=B.innerHTML;break;case "granted-and-disabled":F(!1,b).catch(c=>{console.error("Push subscription failed",c);H("failed",b)});t.checked=!1;t.disabled=!1;u.innerHTML=v.innerHTML;break;default:case "default":t.checked=!1,t.disabled=!1,u.innerHTML=v.innerHTML}}
function I(a){function b(){return G.startsWith(Notification.permission)||"failed"===G?!1:(console.log(G+" changed to "+Notification.permission),"granted"===Notification.permission?H("granted-and-disabled",a):H(Notification.permission,a),!0)}document.getElementById("notifications-not-available-alert").hidden=!0;document.getElementById("toggle-notifications-wrapper").hidden=!1;t.addEventListener("change",()=>{t.checked?(window.Notification.requestPermission().then(c=>{switch(c){case "granted":G="granted-and-enabled";
break;default:G=c}H(G,a)}),plausible("Push Subscription",{props:{[g]:"Subscribe"}})):("granted-and-enabled"===G&&H("granted-and-disabled",a),plausible("Push Subscription",{props:{[g]:"Unsubscribe"}}))});window.addEventListener("focus",b);G=window.localStorage.getItem(g+"-notification-state");if(null==G||"failed"===G)G="default";b()||H(G,a)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(a=>{console.log("ServiceWorker is active:",a.active);"Notification"in window&&"localStorage"in window&&"PushManager"in window?I(a):(console.warn("Push Notifications are not supported"),G="unsupported")});navigator.serviceWorker.register("/sw.min.js").then(a=>{console.log("ServiceWorker registration successful:",a)}).catch(a=>console.warn("ServiceWorker registration failed:",a))}):(console.warn("Service Worker is not supported"),
G="unsupported");const J=document.getElementById("online-status");let K=null;function L(){J.textContent="Aktuell";J.classList.add("online");J.classList.remove("offline","updating")}function M(){J.textContent="Offline";J.classList.add("offline");J.classList.remove("online","updating")}
function N(a=null){K=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");K.addEventListener("open",b=>{console.log("WebSocket opened",b);L();a&&a(b.target)});K.addEventListener("close",b=>{console.log("WebSocket closed",b);M()});K.addEventListener("message",b=>{b=JSON.parse(b.data);console.log("WebSocket message",b);switch(b.type){case "status":(b=b.status)&&(b===document.getElementById("status").textContent?L():
window.location.reload());break;default:console.warn("Unknown WebSocket message type",b.type)}})}N();function O(){J.textContent="Aktualisiere...";J.classList.add("updating");J.classList.remove("online","offline");K.readyState===K.OPEN?K.send(JSON.stringify({type:"get_status"})):N(a=>a.send(JSON.stringify({type:"get_status"})))}window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions");O()});
window.addEventListener("online",()=>{console.log("online, checking for new substitutions");O()});window.addEventListener("offline",()=>{console.log("offline");M()});document.getElementById("themes-block").appendChild(document.getElementById("themes-block-template").content);const P=document.documentElement,Q=document.getElementById("themes-system-default"),R=document.getElementById("themes-light"),S=document.getElementById("themes-dark");
function T(a){localStorage.setItem("theme",a);switch(a){case "system-default":P.classList.remove("light","dark");break;case "light":P.classList.add("light");P.classList.remove("dark");break;case "dark":P.classList.add("dark"),P.classList.remove("light")}}switch(localStorage.getItem("theme")){case "light":R.checked=!0;break;case "dark":S.checked=!0}Q.addEventListener("change",()=>T("system-default"));R.addEventListener("change",()=>T("light"));S.addEventListener("change",()=>T("dark"));try{let a=localStorage.getItem("theme");"system-default"!==a&&a||(a="system-"+(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));plausible("Features - "+g,{props:{Selection:k?(k.match(/,/g)||[]).length+1:0,Notifications:localStorage.getItem(g+"-notification-state-all"),Theme:a,Timetables:null}})}catch(a){console.error(a)}U(document.querySelectorAll("a[data-pa]"),V);U(document.querySelectorAll("button[data-pa]"),W);
function U(a,b){for(let c of a)c.addEventListener("click",b),c.addEventListener("auxclick",b)}function V(a){let b=a.target;const c="auxclick"===a.type&&2===a.which,f="click"===a.type;for(;b&&("undefined"==typeof b.tagName||"a"!==b.tagName.toLowerCase()||!b.href);)b=b.parentNode;(c||f)&&X(b.getAttribute("data-pa"));b.target||a.ctrlKey||a.metaKey||a.shiftKey||!f||(setTimeout(function(){location.href=b.href},150),a.preventDefault())}
function W(a){a.preventDefault();X(a.target.getAttribute("data-pa"));setTimeout(function(){a.target.form.submit()},150)}function X(a){a=a.split(",");plausible(JSON.parse(a[0]),a[1]?{props:JSON.parse(a[1])}:null)};}).call(this);

//# sourceMappingURL=substitutions/substitutions.min.js.map
