'use strict';const c=document.getElementsByClassName("date");
function d(){const a=new Date;if(0<c.length&&c[0].innerHTML===a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()){const b=a.getHours(),e=a.getMinutes();for(let f of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(f[1]<b||f[1]===b&&f[2]<=e)for(let g of document.getElementsByClassName("lesson"+f[0]))g.classList.add("grey");else{setTimeout(d,(new Date(a.getFullYear(),a.getMonth(),a.getDate(),f[1],f[2])).getTime()-a.getTime());
break}}}d();let h=window.location.pathname.split("/",2)[1];const k=document.getElementById("online-status");let l=!1;
function m(){if(l)return null;const a=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");a.addEventListener("open",b=>{l=!0;k.textContent="Aktuell";k.classList.add("online");k.classList.remove("offline");console.log("WebSocket opened",b)});a.addEventListener("close",b=>{l=!1;k.textContent="Keine Verbindung zum Server";k.classList.add("offline");k.classList.remove("online");console.log("WebSocket closed",b)});a.addEventListener("message",
b=>{b=JSON.parse(b.data);console.log("WebSocket message",b);switch(b.type){case "new_substitutions":window.location.reload();break;default:console.warn("Unknown WebSocket message type")}});window.addEventListener("offline",()=>{console.log("offline, closing WebSocket connection");a.close()});return a}m();function n(){const a=m();null!=a&&a.addEventListener("open",()=>{a.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent}))})}
window.addEventListener("focus",()=>{n()});window.addEventListener("online",()=>{console.log("online");n()});const q=document.getElementById("selectionInput").value,r=document.getElementById("toggle-notifications"),t=document.getElementById("notifications-info"),u=document.getElementById("notifications-info-none"),v=document.getElementById("notifications-info-all"),w=document.getElementById("notifications-info-selection"),x=document.getElementById("notifications-info-blocked"),y=document.getElementById("notifications-info-failed");
function z(a){var b="=".repeat((4-a.length%4)%4);a=(a+b).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);b=new Uint8Array(a.length);for(let e=0;e<a.length;++e)b[e]=a.charCodeAt(e);return b}
function A(a,b){return new Promise((e,f)=>{b.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:z("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(g=>{console.log("Got push subscription:",g,a?"(active)":"(not active)");fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:g.toJSON(),selection:q,is_active:a})}).then(p=>p.json()).then(p=>
{p.ok?(console.log("Push subscription successful"),e()):(console.error("Push subscription failed"),f())})}).catch(g=>{console.error("Push subscription failed",g);f(g)})})}let B;
function C(a,b){console.log("Setting notification-state to",a);B=a;window.localStorage.setItem(h+"-notification-state",B);switch(B){case "granted-and-enabled":r.checked=!0;r.disabled=!1;t.innerHTML=""!==q?w.innerHTML.replace("{selection}",q):v.innerHTML;A(!0,b).catch(()=>{C("failed",b)});break;case "denied":r.checked=!1;r.disabled=!0;t.innerHTML=x.innerHTML;break;case "failed":r.checked=!1;r.disabled=!0;t.innerHTML=y.innerHTML;break;case "granted-and-disabled":A(!1,b).catch(()=>{C("failed",b)});r.checked=
!1;r.disabled=!1;t.innerHTML=u.innerHTML;break;default:case "default":r.checked=!1,r.disabled=!1,t.innerHTML=u.innerHTML}}
function D(a){function b(){return B.startsWith(Notification.permission)?!1:("granted"===Notification.permission?C("granted-and-disabled",a):C(Notification.permission,a),!0)}document.getElementById("notifications-block").hidden=!1;r.addEventListener("change",()=>{r.checked?window.Notification.requestPermission().then(e=>{switch(e){case "granted":B="granted-and-enabled";break;default:B=e}C(B,a)}):"granted-and-enabled"===B&&C("granted-and-disabled",a)});window.addEventListener("focus",b);B=window.localStorage.getItem(h+
"-notification-state");null==B&&(B="default");b()||C(B,a)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(a=>{console.log("ServiceWorker is active:",a.active);"Notification"in window?"localStorage"in window?D(a):console.warn("localStorage is not supported"):console.warn("Notification is not supported")});navigator.serviceWorker.register("/sw.min.js").then(a=>{console.log("ServiceWorker registration successful:",a)}).catch(a=>console.warn("ServiceWorker registration failed:",a))}):console.warn("serviceWorker is not supported");

//# sourceMappingURL=substitutions.min.js.map
