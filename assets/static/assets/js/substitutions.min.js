'use strict';try{var q=function(){const d=new Date;if(0<a.length&&a[0].innerHTML===d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()){const e=d.getHours(),l=d.getMinutes();for(let n of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(n[1]<e||n[1]===e&&n[2]<=l)for(let x of document.getElementsByClassName("lesson"+n[0]))x.classList.add("grey");else{setTimeout(q,(new Date(d.getFullYear(),d.getMonth(),d.getDate(),n[1],n[2])).getTime()-
d.getTime());break}}};const a=document.getElementsByClassName("date");q()}catch(a){console.error(a)}let r=window.location.pathname.split("/",2)[1];const y=document.getElementById("toggle-notifications"),z=document.getElementById("notifications-info"),A=document.getElementById("notifications-info-none"),B=document.getElementById("notifications-info-all"),C=document.getElementById("notifications-info-selection"),D=document.getElementById("notifications-info-blocked"),F=document.getElementById("notifications-info-failed");
function G(a){var d="=".repeat((4-a.length%4)%4);a=(a+d).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);d=new Uint8Array(a.length);for(let e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}
function H(a,d){return new Promise((e,l)=>{d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:G("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(n=>{console.log("Got push subscription:",n,a?"(active)":"(not active)");fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:n.toJSON(),selection:I,is_active:a})}).then(x=>x.json()).then(x=>
{x.ok?(console.log("Push subscription successful"),e()):(console.error("Push subscription failed",x),l())})}).catch(n=>{console.error("Push subscription failed",n);l(n)})})}let J;
function K(a,d){console.log("Setting notification-state to",a);J=a;window.localStorage.setItem(r+"-notification-state",J);switch(J){case "granted-and-enabled":y.checked=!0;y.disabled=!1;z.innerHTML=""!==I?C.innerHTML.replace("{selection}",I):B.innerHTML;H(!0,d).catch(e=>{console.error("Push subscription failed",e);K("failed",d)});break;case "denied":y.checked=!1;y.disabled=!0;z.innerHTML=D.innerHTML;break;case "failed":y.checked=!1;y.disabled=!0;z.innerHTML=F.innerHTML;break;case "granted-and-disabled":H(!1,
d).catch(e=>{console.error("Push subscription failed",e);K("failed",d)});y.checked=!1;y.disabled=!1;z.innerHTML=A.innerHTML;break;default:case "default":y.checked=!1,y.disabled=!1,z.innerHTML=A.innerHTML}}
function L(a){function d(){return J.startsWith(Notification.permission)?!1:("granted"===Notification.permission?K("granted-and-disabled",a):K(Notification.permission,a),!0)}document.getElementById("notifications-not-available-alert").hidden=!0;document.getElementById("toggle-notifications-wrapper").hidden=!1;y.addEventListener("change",()=>{y.checked?window.Notification.requestPermission().then(e=>{switch(e){case "granted":J="granted-and-enabled";break;default:J=e}K(J,a)}):"granted-and-enabled"===
J&&K("granted-and-disabled",a)});window.addEventListener("focus",d);J=window.localStorage.getItem(r+"-notification-state");null==J&&(J="default");d()||K(J,a)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(a=>{console.log("ServiceWorker is active:",a.active);"Notification"in window?"localStorage"in window?"PushManager"in window?L(a):console.warn("PushManager is not supported"):console.warn("localStorage is not supported"):console.warn("Notification is not supported")});navigator.serviceWorker.register("/sw.min.js").then(a=>{console.log("ServiceWorker registration successful:",a)}).catch(a=>console.warn("ServiceWorker registration failed:",
a))}):console.warn("serviceWorker is not supported");
try{var N=function(){d.readyState===d.OPEN?d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})):M(()=>d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})))},M=function(e=null){d=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");d.addEventListener("open",l=>{console.log("WebSocket opened",l);O();e&&e()});d.addEventListener("close",
l=>{console.log("WebSocket closed",l);P()});d.addEventListener("message",l=>{l=JSON.parse(l.data);console.log("WebSocket message",l);switch(l.type){case "new_substitutions":window.location.reload();break;default:console.warn("Unknown WebSocket message type")}})},P=function(){a.textContent="Keine Verbindung zum Server";a.classList.add("offline");a.classList.remove("online")},O=function(){a.textContent="Aktuell";a.classList.add("online");a.classList.remove("offline")};const a=document.getElementById("online-status");
let d=null;M();window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions");N()});window.addEventListener("online",()=>{console.log("online, checking for new substitutions");N()});window.addEventListener("offline",()=>{console.log("offline, closing WebSocket connection");P();d.close()})}catch(a){console.error(a)}const I=document.getElementById("selectionInput").value;
try{let a;try{(a=JSON.parse(window.localStorage.getItem(r+"-timetables")))||(a={})}catch(e){a={}}const d=document.getElementById("timetables-block");if(null!=d&&I){var Q=function(v,m=null,w=!0){m||(m=v.value);var h=v.dataset.selection;if(h in e){h=e[h];let k=v.dataset.weekdayName;if(k in h&&(m=m.toUpperCase(),h=h[k][v.dataset.lesson-1],m in h))for(let f of h[m])w?f.classList.add("is-relevant"):f.classList.remove("is-relevant")}};const e={};for(let v of document.getElementsByClassName("substitutions-box")){const m=
v.querySelector(".substitutions-table tbody");if(m){var R=function(){var f=[];var p=h.match(/^(\d+)([A-Za-z]*)$/);if(null!=p){var b=p[1];p=p[2].toUpperCase()}else b="",p=h.toUpperCase();if(""!==b)if(""!==p)for(let g of p)f.push(b+g);else f.push(b);else f.push(p);b=[];for(let g of I.split(", ")){g=g.toUpperCase();for(let c of f)if(c.includes(g)){b.push(g);break}}console.log(h,f,b);for(let g of b)if(g in e||(e[g]={}),w in e[g])for(f=0;10>f;f++)e[g][w][f]=Object.assign(e[g][w][f],k[f]);else e[g][w]=
k};const w=v.querySelector(".day-name").textContent;let h=null,k=[{},{},{},{},{},{},{},{},{},{}];for(let f of m.children){let p=f.querySelector(".group-name"),b,g;null!=p?(null!=h&&R(),k=[{},{},{},{},{},{},{},{},{},{}],h=p.textContent,b=f.children[1].textContent.toUpperCase(),g=f.children[3].textContent):(b=f.children[0].textContent.toUpperCase(),g=f.children[2].textContent);for(let c of g.match(/(\d+)/g))c=parseInt(c),b in k[c-1]?k[c-1][b].push(f):k[c-1][b]=[f]}null!=h&&R()}}console.log(e);const l=
document.getElementById("timetables-block-template"),n=document.getElementById("timetable-template");d.appendChild(l.content);const x=document.getElementById("timetables-container");for(let v of I.split(", ")){let m=v.toUpperCase();m in a||(a[m]=[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,
null]]);const w=n.content.firstElementChild.cloneNode(!0);x.appendChild(w);w.querySelector(".timetable-selection").innerText=v;const h=w.querySelector("tbody");for(let k=1;11>k;k++){var S=function(b,g){let c=parseInt(b.dataset.weekday),t=parseInt(b.dataset.lesson);c+=g;return 0<=c&&4>=c?(document.getElementById("timetable-"+b.dataset.selection+"-"+c+"-"+t).focus(),!0):!1},T=function(b,g){let c=parseInt(b.dataset.weekday),t=parseInt(b.dataset.lesson);t+=g;if(1>t){c--;if(0>c)return!1;t=10}else if(10<
t){c++;if(5<=c)return!1;t=1}document.getElementById("timetable-"+b.dataset.selection+"-"+c+"-"+t).focus();return!0};const f=document.createElement("tr");h.appendChild(f);const p=document.createElement("th");f.appendChild(p);p.innerText=k+".";for(let b=0;5>b;b++){const g=document.createElement("td");f.appendChild(g);const c=document.createElement("input");g.appendChild(c);c.classList.add("form-control","form-control-sm");c.id="timetable-"+m+"-"+b+"-"+k;const t=["Montag","Dienstag","Mittwoch","Donnerstag",
"Freitag"][b];c.setAttribute("type","text");c.setAttribute("autocapitalize","characters");c.setAttribute("autocomplete","off");c.setAttribute("autocorrect","off");c.setAttribute("spellcheck","false");c.setAttribute("enterkeyhint",4===b&&10===k?"done":"next");c.setAttribute("maxlength","3");c.setAttribute("aria-label",`${k}. Stunde ${t}`);c.addEventListener("focus",u=>u.target.select());c.addEventListener("input",u=>{Q(u.target,u.target.dataset.oldvalue,!1);Q(u.target);u.target.dataset.oldvalue=u.target.value;
a[u.target.dataset.selection][parseInt(u.target.dataset.weekday)][parseInt(u.target.dataset.lesson)-1]=u.target.value.toUpperCase();window.localStorage.setItem(r+"-timetables",JSON.stringify(a))});c.dataset.selection=m;c.dataset.weekday=b;c.dataset.weekdayName=t;c.dataset.lesson=k;let E=a[m][b][k-1];null!=E?(c.value=E,c.dataset.oldvalue=E,Q(c)):c.dataset.oldvalue=""}h.addEventListener("keydown",b=>{switch(b.key){case "Tab":case "Enter":T(b.target,b.shiftKey?-1:1)&&b.preventDefault();break;case "ArrowDown":T(b.target,
1)&&b.preventDefault();break;case "ArrowUp":T(b.target,-1)&&b.preventDefault();break;case "ArrowLeft":0!==b.target.selectionStart||1!==b.target.selectionEnd&&0!==b.target.selectionEnd||S(b.target,-1)&&b.preventDefault();break;case "ArrowRight":b.target.selectionStart===b.target.selectionEnd&&S(b.target,1)&&b.preventDefault()}});h.addEventListener("input",b=>{b.target.value.length>=b.target.maxLength&&T(b.target,1)})}}}}catch(a){console.error(a)};

//# sourceMappingURL=substitutions.min.js.map
