'use strict';try{var r=function(){const d=new Date;if(0<a.length&&a[0].innerHTML===d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()){const e=d.getHours(),l=d.getMinutes();for(let m of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(m[1]<e||m[1]===e&&m[2]<=l)for(let w of document.getElementsByClassName("lesson"+m[0]))w.classList.add("grey");else{setTimeout(r,(new Date(d.getFullYear(),d.getMonth(),d.getDate(),m[1],m[2])).getTime()-
d.getTime());break}}};const a=document.getElementsByClassName("date");r()}catch(a){console.error(a)}let t=window.location.pathname.split("/",2)[1];const x=document.getElementById("toggle-notifications"),y=document.getElementById("notifications-info"),z=document.getElementById("notifications-info-none"),A=document.getElementById("notifications-info-all"),B=document.getElementById("notifications-info-selection"),C=document.getElementById("notifications-info-blocked"),E=document.getElementById("notifications-info-failed");
function F(a){var d="=".repeat((4-a.length%4)%4);a=(a+d).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);d=new Uint8Array(a.length);for(let e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}
function G(a,d){return new Promise((e,l)=>{d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:F("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(m=>{console.log("Got push subscription:",m,a?"(active)":"(not active)");fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:m.toJSON(),selection:H,is_active:a})}).then(w=>w.json()).then(w=>
{w.ok?(console.log("Push subscription successful"),e()):(console.error("Push subscription failed",w),l())})}).catch(m=>{console.error("Push subscription failed",m);l(m)})})}let I;
function J(a,d){console.log("Setting notification-state to",a);I=a;window.localStorage.setItem(t+"-notification-state",I);switch(I){case "granted-and-enabled":x.checked=!0;x.disabled=!1;y.innerHTML=""!==H?B.innerHTML.replace("{selection}",H):A.innerHTML;G(!0,d).catch(e=>{console.error("Push subscription failed",e);J("failed",d)});break;case "denied":x.checked=!1;x.disabled=!0;y.innerHTML=C.innerHTML;break;case "failed":x.checked=!1;x.disabled=!0;y.innerHTML=E.innerHTML;break;case "granted-and-disabled":G(!1,
d).catch(e=>{console.error("Push subscription failed",e);J("failed",d)});x.checked=!1;x.disabled=!1;y.innerHTML=z.innerHTML;break;default:case "default":x.checked=!1,x.disabled=!1,y.innerHTML=z.innerHTML}}
function K(a){function d(){return I.startsWith(Notification.permission)?!1:("granted"===Notification.permission?J("granted-and-disabled",a):J(Notification.permission,a),!0)}document.getElementById("notifications-not-available-alert").hidden=!0;document.getElementById("toggle-notifications-wrapper").hidden=!1;x.addEventListener("change",()=>{x.checked?window.Notification.requestPermission().then(e=>{switch(e){case "granted":I="granted-and-enabled";break;default:I=e}J(I,a)}):"granted-and-enabled"===
I&&J("granted-and-disabled",a)});window.addEventListener("focus",d);I=window.localStorage.getItem(t+"-notification-state");null==I&&(I="default");d()||J(I,a)}
"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(a=>{console.log("ServiceWorker is active:",a.active);"Notification"in window?"localStorage"in window?"PushManager"in window?K(a):console.warn("PushManager is not supported"):console.warn("localStorage is not supported"):console.warn("Notification is not supported")});navigator.serviceWorker.register("/sw.min.js").then(a=>{console.log("ServiceWorker registration successful:",a)}).catch(a=>console.warn("ServiceWorker registration failed:",
a))}):console.warn("serviceWorker is not supported");
try{var M=function(){d.readyState===d.OPEN?d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})):L(()=>d.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent})))},L=function(e=null){d=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");d.addEventListener("open",l=>{console.log("WebSocket opened",l);N();e&&e()});d.addEventListener("close",
l=>{console.log("WebSocket closed",l);O()});d.addEventListener("message",l=>{l=JSON.parse(l.data);console.log("WebSocket message",l);switch(l.type){case "new_substitutions":window.location.reload();break;default:console.warn("Unknown WebSocket message type")}})},O=function(){a.textContent="Keine Verbindung zum Server";a.classList.add("offline");a.classList.remove("online")},N=function(){a.textContent="Aktuell";a.classList.add("online");a.classList.remove("offline")};const a=document.getElementById("online-status");
let d=null;L();window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions");M()});window.addEventListener("online",()=>{console.log("online, checking for new substitutions");M()});window.addEventListener("offline",()=>{console.log("offline, closing WebSocket connection");O();d.close()})}catch(a){console.error(a)}const H=document.getElementById("selectionInput").value;
try{let a;try{(a=JSON.parse(window.localStorage.getItem(t+"-timetables")))||(a={})}catch(e){a={}}const d=document.getElementById("timetables-block");if(null!=d&&H){var P=function(n,p=null,v=!0){p||(p=n.value);var g=n.dataset.selection;if(g in e){g=e[g];let q=n.dataset.weekdayName;if(q in g&&(p=p.toUpperCase(),g=g[q][n.dataset.lesson-1],p in g))for(let f of g[p])v?f.classList.add("is-relevant"):f.classList.remove("is-relevant")}};const e={};for(let n of document.getElementsByClassName("substitutions-box")){const p=
n.querySelector(".substitutions-table tbody");if(p){var Q=function(){var f=[];var b=g.match(/^(\d+)([A-Za-z]*)$/);if(null!=b){var h=b[1];b=b[2]}else h="",b=g;if(""!==h)if(""!==b)for(let c of b)f.push(h+c);else f.push(h);else f.push(b);h=[];for(let c of H.split(", "))for(let k of f)if(k.includes(c)){h.push(c);break}console.log(g,f,h);for(let c of h)if(c in e||(e[c]={}),v in e[c])for(f=0;10>f;f++)e[c][v][f]=Object.assign(e[c][v][f],q[f]);else e[c][v]=q};const v=n.querySelector(".day-name").textContent;
let g=null,q=[{},{},{},{},{},{},{},{},{},{}];for(let f of p.children){let b=f.querySelector(".group-name"),h,c;null!=b?(null!=g&&Q(),q=[{},{},{},{},{},{},{},{},{},{}],g=b.textContent,h=f.children[1].textContent.toUpperCase(),c=f.children[3].textContent):(h=f.children[0].textContent.toUpperCase(),c=f.children[2].textContent);for(let k of c.match(/(\d+)/g))k=parseInt(k),h in q[k-1]?q[k-1][h].push(f):q[k-1][h]=[f]}null!=g&&Q()}}console.log(e);const l=document.getElementById("timetables-block-template"),
m=document.getElementById("timetable-template");d.appendChild(l.content);const w=document.getElementById("timetables-container");for(let n of H.split(", ")){n in a||(a[n]=[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null]]);const p=m.content.firstElementChild.cloneNode(!0);w.appendChild(p);
p.querySelector(".timetable-selection").innerText=n;const v=p.querySelector("tbody");for(let g=1;11>g;g++){var R=function(b,h){let c=parseInt(b.dataset.weekday),k=parseInt(b.dataset.lesson);c+=h;return 0<=c&&4>=c?(document.getElementById(b.dataset.selection+"-"+c+"-"+k).focus(),!0):!1},S=function(b,h){let c=parseInt(b.dataset.weekday),k=parseInt(b.dataset.lesson);k+=h;if(1>k){c--;if(0>c)return!1;k=10}else if(10<k){c++;if(5<=c)return!1;k=1}document.getElementById(b.dataset.selection+"-"+c+"-"+k).focus();
return!0};const q=document.createElement("tr");v.appendChild(q);const f=document.createElement("th");q.appendChild(f);f.innerText=g+".";for(let b=0;5>b;b++){const h=document.createElement("td");q.appendChild(h);const c=document.createElement("input");h.appendChild(c);c.classList.add("form-control","form-control-sm");c.id=n+"-"+b+"-"+g;const k=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag"][b];c.setAttribute("type","text");c.setAttribute("autocapitalize","characters");c.setAttribute("maxlength",
"3");c.setAttribute("aria-label",`${g}. Stunde ${k}`);c.addEventListener("focus",u=>u.target.select());c.addEventListener("input",u=>{P(u.target,u.target.dataset.oldvalue,!1);P(u.target);u.target.dataset.oldvalue=u.target.value;a[u.target.dataset.selection][parseInt(u.target.dataset.weekday)][parseInt(u.target.dataset.lesson)-1]=u.target.value.toUpperCase();window.localStorage.setItem(t+"-timetables",JSON.stringify(a))});c.dataset.selection=n;c.dataset.weekday=b;c.dataset.weekdayName=k;c.dataset.lesson=
g;let D=a[n][b][g-1];null!=D?(c.value=D,c.dataset.oldvalue=D,P(c)):c.dataset.oldvalue=""}v.addEventListener("keydown",b=>{switch(b.key){case "Tab":S(b.target,b.shiftKey?-1:1)&&b.preventDefault();break;case "ArrowDown":S(b.target,1)&&b.preventDefault();break;case "ArrowUp":S(b.target,-1)&&b.preventDefault();break;case "ArrowLeft":0!==b.target.selectionStart||1!==b.target.selectionEnd&&0!==b.target.selectionEnd||R(b.target,-1)&&b.preventDefault();break;case "ArrowRight":b.target.selectionStart===b.target.selectionEnd&&
R(b.target,1)&&b.preventDefault()}});v.addEventListener("input",b=>{b.target.value.length>=b.target.maxLength&&S(b.target,1)})}}}}catch(a){console.error(a)};

//# sourceMappingURL=substitutions.min.js.map
