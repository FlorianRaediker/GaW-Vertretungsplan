!function(){"use strict";const u=document.getElementById("selectionInput").value,o=window.location.pathname.split("/",2)[1];let s;try{s=JSON.parse(window.localStorage.getItem(o+"-timetables")),s=s||{}}catch{s={}}const e=document.getElementById("timetables-block");if(u){const g={};for(var t of document.getElementsByClassName("substitutions-box")){var a=t.querySelector(".substitutions-table tbody");if(a){const v=t.querySelector(".day-name").textContent;let c=null,d=[{},{},{},{},{},{},{},{},{},{}];function n(){let e,t;const a=[];let n=c.match(/^(\d+)([A-Za-z]*)$/);if(e=null!=n?(t=n[1],n[2].toUpperCase()):(t="",c.toUpperCase()),""!==t)if(""!==e)for(var l of e)a.push(t+l);else a.push(t);else a.push(e);let r=[];for(var o of u.split(", ")){o=o.toUpperCase();for(var s of a)if(s.includes(o)){r.push(o);break}}for(var i of r)if(i in g||(g[i]={}),v in g[i])for(let e=0;e<10;e++)g[i][v][e]=Object.assign(g[i][v][e],d[e]);else g[i][v]=d}for(var l of a.children){var r,i=l.querySelector(".group-name");let e,t;t=null!=i?(null!=c&&n(),d=[{},{},{},{},{},{},{},{},{},{}],c=i.textContent,e=l.children[1].textContent.toUpperCase(),l.children[3].textContent):(e=l.children[0].textContent.toUpperCase(),l.children[2].textContent);for(r of t.match(/(\d+)/g))r=parseInt(r),1<=r&&r<=10&&(e in d[r-1]?d[r-1][e].push(l):d[r-1][e]=[l])}null!=c&&n()}}console.log(g);var c=document.getElementById("timetables-block-template");const b=document.getElementById("timetable-template");e.appendChild(c.content);const h=document.getElementById("timetables-container");function d(e,t=null,a=!0){t=t||e.value;var n=e.dataset.selection;if(n in g){var l=g[n],n=e.dataset.weekdayName;if(n in l){t=t.toUpperCase();if(t in(l=l[n][e.dataset.lesson-1]))for(var r of l[t])a?r.classList.add("is-relevant"):r.classList.remove("is-relevant")}}}for(let t of u.split(", ")){let r=t.toUpperCase();r in s||(s[r]=[Array(10).fill(""),Array(10).fill(""),Array(10).fill(""),Array(10).fill(""),Array(10).fill("")]);const y=b.content.firstElementChild.cloneNode(!0);h.appendChild(y),y.querySelectorAll(".timetable-selection").forEach(e=>e.innerText=t),y.querySelector(".share-timetable-button").addEventListener("click",()=>{const e=y.querySelector(".share-timetable-block");if(e.hidden){const a=e.querySelector(".timetable-link-input"),l=e.querySelector(".copy-timetable-link");let n="";for(let a=0;a<5;a++)for(let t=0;t<10;t++){let e=s[r][a][t];e?(3<e.length&&(e=e.substr(0,3)),n+=e+" ".repeat(3-e.length)):n+="   "}a.value=new URL("/"+o+"/#timetable:"+r+":"+btoa(n),window.location.origin).href,a.addEventListener("click",e=>e.target.select());let t=null;l.addEventListener("click",()=>{function e(){null!=t&&clearTimeout(t),t=setTimeout(()=>{l.classList.remove("copied"),l.classList.remove("copying-failed"),l.title="Kopieren",t=null},2e3)}navigator.clipboard.writeText(a.value).then(()=>{l.classList.add("copied"),l.title="Kopiert!",e(),plausible("Timetable: Copy Link")}).catch(()=>{l.classList.add("copying-failed"),l.title="Kopieren fehlgeschlagen",e()})}),e.hidden=!1}else e.hidden=!0});const E=y.querySelector("tbody");for(let t=1;t<11;t++){const k=document.createElement("tr");E.appendChild(k);const w=document.createElement("th");k.appendChild(w),w.innerText=t+".";for(let e=0;e<5;e++){const C=document.createElement("td");k.appendChild(C);const A=document.createElement("input");C.appendChild(A),A.classList.add("form-control","form-control-sm"),A.id="timetable-"+r+"-"+e+"-"+t;var p=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag"][e];A.setAttribute("type","text"),A.setAttribute("autocapitalize","characters"),A.setAttribute("autocomplete","off"),A.setAttribute("autocorrect","off"),A.setAttribute("spellcheck","false"),A.setAttribute("enterkeyhint",4===e&&10===t?"done":"next"),A.setAttribute("maxlength","3"),A.setAttribute("aria-label",`${t}. Stunde ${p}`),A.addEventListener("focus",e=>e.target.select()),A.addEventListener("input",e=>{d(e.target,e.target.dataset.oldvalue,!1),d(e.target),e.target.dataset.oldvalue=e.target.value,s[e.target.dataset.selection][parseInt(e.target.dataset.weekday)][parseInt(e.target.dataset.lesson)-1]=e.target.value.toUpperCase(),window.localStorage.setItem(o+"-timetables",JSON.stringify(s))}),A.dataset.selection=r,A.dataset.weekday=e,A.dataset.weekdayName=p,A.dataset.lesson=t;p=s[r][e][t-1];p?(A.value=p,A.dataset.oldvalue=p,d(A)):A.dataset.oldvalue=""}function f(e,t){let a=parseInt(e.dataset.weekday),n=parseInt(e.dataset.lesson);if(n+=t,n<1){if(a--,a<0)return;n=10}else if(10<n){if(a++,5<=a)return void e.blur();n=1}return document.getElementById("timetable-"+e.dataset.selection+"-"+a+"-"+n).focus(),1}function m(e,t){var a=parseInt(e.dataset.weekday),n=parseInt(e.dataset.lesson);return 0<=(a+=t)&&a<=4&&(document.getElementById("timetable-"+e.dataset.selection+"-"+a+"-"+n).focus(),1)}E.addEventListener("keydown",e=>{switch(e.key){case"Tab":case"Enter":f(e.target,e.shiftKey?-1:1)&&e.preventDefault();break;case"ArrowDown":f(e.target,1)&&e.preventDefault();break;case"ArrowUp":f(e.target,-1)&&e.preventDefault();break;case"ArrowLeft":0!==e.target.selectionStart||1!==e.target.selectionEnd&&0!==e.target.selectionEnd||m(e.target,-1)&&e.preventDefault();break;case"ArrowRight":e.target.selectionStart===e.target.selectionEnd&&m(e.target,1)&&e.preventDefault()}}),E.addEventListener("input",e=>{e.target.value.length>=e.target.maxLength&&f(e.target,1)})}}}}();
//# sourceMappingURL=timetables.js.map
