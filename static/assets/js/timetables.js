!function(){"use strict";const u=document.getElementById("selectionInput").value,o=window.location.pathname.split("/",2)[1];let s;try{s=JSON.parse(window.localStorage.getItem(o+"-timetables")),s=s||{}}catch{s={}}if(u){const p={};for(var e of document.getElementsByClassName("substitutions-box")){var t=e.querySelector(".substitutions-table tbody");if(t){const h=e.querySelector(".day-name").textContent;let c=null,d=[{},{},{},{},{},{},{},{},{},{}];function a(){let e,t;const a=[];let n=c.match(/^(\d+)([A-Za-z]*)$/);if(e=null!=n?(t=n[1],n[2].toUpperCase()):(t="",c.toUpperCase()),""!==t)if(""!==e)for(var l of e)a.push(t+l);else a.push(t);else a.push(e);let r=[];for(var o of u.split(", ")){o=o.toUpperCase();for(var s of a)if(s.includes(o)){r.push(o);break}}for(var i of r)if(i in p||(p[i]={}),h in p[i])for(let e=0;e<10;e++)p[i][h][e]=Object.assign(p[i][h][e],d[e]);else p[i][h]=d}for(var n of t.children){var l=n.querySelector(".group-name");let e,t;t=null!=l?(null!=c&&a(),d=[{},{},{},{},{},{},{},{},{},{}],c=l.textContent,e=n.children[3].textContent.toUpperCase(),n.children[1].textContent):(e=n.children[2].textContent.toUpperCase(),n.children[0].textContent);var r,l=e.match(/\((\w+)\)/);l&&(e=l[1]);for(r of t.match(/(\d+)/g))r=parseInt(r),1<=r&&r<=10&&(e in d[r-1]?d[r-1][e].push(n):d[r-1][e]=[n])}null!=c&&a()}}console.log(p);const m=document.getElementById("timetable-template"),g=document.getElementById("timetables-container");function i(e,t=null,a=!0){t=t||e.value;var n=e.dataset.selection;if(n in p){var l=p[n],n=e.dataset.weekdayName;if(n in l){t=t.toUpperCase();if(t in(l=l[n][e.dataset.lesson-1]))for(var r of l[t])a?r.classList.add("is-relevant"):r.classList.remove("is-relevant")}}}for(let t of u.split(", ")){let r=t.toUpperCase();r in s||(s[r]=[Array(10).fill(""),Array(10).fill(""),Array(10).fill(""),Array(10).fill(""),Array(10).fill("")]);const v=m.content.firstElementChild.cloneNode(!0);g.appendChild(v),v.querySelectorAll(".timetable-selection").forEach(e=>e.innerText=t),v.querySelector(".share-timetable-button").addEventListener("click",()=>{const e=v.querySelector(".share-timetable-block");if(e.hidden){const a=e.querySelector(".timetable-link-input"),l=e.querySelector(".copy-timetable-link");let n="";for(let a=0;a<5;a++)for(let t=0;t<10;t++){let e=s[r][a][t];e?(3<e.length&&(e=e.substr(0,3)),n+=e+" ".repeat(3-e.length)):n+="   "}a.value=new URL("/"+o+"/#timetable:"+r+":"+btoa(n),window.location.origin).href,a.addEventListener("click",e=>e.target.select());let t=null;l.addEventListener("click",()=>{function e(){null!=t&&clearTimeout(t),t=setTimeout(()=>{l.classList.remove("copied"),l.classList.remove("copying-failed"),l.title="Kopieren",t=null},2e3)}navigator.clipboard.writeText(a.value).then(()=>{l.classList.add("copied"),l.title="Kopiert!",e(),plausible("Timetable: Copy Link")}).catch(()=>{l.classList.add("copying-failed"),l.title="Kopieren fehlgeschlagen",e()})}),e.hidden=!1}else e.hidden=!0});const b=v.querySelector("tbody");for(let t=1;t<11;t++){const y=document.createElement("tr");b.appendChild(y);const w=document.createElement("th");y.appendChild(w),w.innerText=t+".";for(let e=0;e<5;e++){const E=document.createElement("td");y.appendChild(E);const k=document.createElement("input");E.appendChild(k),k.classList.add("form-control","form-control-sm"),k.id="timetable-"+r+"-"+e+"-"+t;var c=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag"][e];k.setAttribute("type","text"),k.setAttribute("autocapitalize","characters"),k.setAttribute("autocomplete","off"),k.setAttribute("autocorrect","off"),k.setAttribute("spellcheck","false"),k.setAttribute("enterkeyhint",4===e&&10===t?"done":"next"),k.setAttribute("maxlength","3"),k.setAttribute("aria-label",`${t}. Stunde ${c}`),k.addEventListener("focus",e=>e.target.select()),k.addEventListener("input",e=>{i(e.target,e.target.dataset.oldvalue,!1),i(e.target),e.target.dataset.oldvalue=e.target.value,s[e.target.dataset.selection][parseInt(e.target.dataset.weekday)][parseInt(e.target.dataset.lesson)-1]=e.target.value.toUpperCase(),window.localStorage.setItem(o+"-timetables",JSON.stringify(s))}),k.dataset.selection=r,k.dataset.weekday=e,k.dataset.weekdayName=c,k.dataset.lesson=t;c=s[r][e][t-1];c?(k.value=c,k.dataset.oldvalue=c,i(k)):k.dataset.oldvalue=""}function d(e,t){let a=parseInt(e.dataset.weekday),n=parseInt(e.dataset.lesson);if(n+=t,n<1){if(a--,a<0)return;n=10}else if(10<n){if(a++,5<=a)return void e.blur();n=1}return document.getElementById("timetable-"+e.dataset.selection+"-"+a+"-"+n).focus(),1}function f(e,t){var a=parseInt(e.dataset.weekday),n=parseInt(e.dataset.lesson);return 0<=(a+=t)&&a<=4&&(document.getElementById("timetable-"+e.dataset.selection+"-"+a+"-"+n).focus(),1)}b.addEventListener("keydown",e=>{switch(e.key){case"Tab":case"Enter":d(e.target,e.shiftKey?-1:1)&&e.preventDefault();break;case"ArrowDown":d(e.target,1)&&e.preventDefault();break;case"ArrowUp":d(e.target,-1)&&e.preventDefault();break;case"ArrowLeft":0!==e.target.selectionStart||1!==e.target.selectionEnd&&0!==e.target.selectionEnd||f(e.target,-1)&&e.preventDefault();break;case"ArrowRight":e.target.selectionStart===e.target.selectionEnd&&f(e.target,1)&&e.preventDefault()}}),b.addEventListener("input",e=>{e.target.value.length>=e.target.maxLength&&d(e.target,1)})}}}}();
//# sourceMappingURL=timetables.js.map
