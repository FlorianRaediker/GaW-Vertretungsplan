!function(){"use strict";function t(e,t=null){try{var n=e.name,o=(null==t?void 0:t.message)||e.message,i=e.description,s=e.number,a=(null==t?void 0:t.filename)||e.fileName,r=(null==t?void 0:t.lineno)||e.lineNumber,l=(null==t?void 0:t.colno)||e.columnNumber,c=(null==t?void 0:t.stack)||e.stack;plausible("JavaScript Error",{props:{[(n||"Generic Error")+": "+o]:c+" - "+a+":"+r+":"+l+" "+i+" "+s}})}catch(e){console.error("reporting error failed",e)}}window.addEventListener("error",e=>t(e.error,e)),window.addEventListener("unhandledrejection",e=>t(e.reason));const s=window.location.pathname.split("/",2)[1],a=document.getElementById("selectionInput").value;if(window.location.hash.startsWith("#timetable:"))try{let[,n,o]=window.location.hash.split(":");o=atob(o);let e=!0,i;if(150!==o.length)console.warn("Timetable in URL has wrong length:",o.length,"instead of",150,o),e=!1;else{i=[];for(let n=0;n<5;n++){let t=[];i.push(t);for(let e=0;e<10;e++){var r=o.substr(10*n*3+3*e,3).trim();t.push(r)}}}if(e){let e;try{e=JSON.parse(window.localStorage.getItem(s+"-timetables")),e=e||{}}catch{e={}}n=n.toUpperCase();let t=n in e?"Die aufgerufene URL enthält einen Stundenplan für "+n+". Soll der aktuell gespeicherte Stundenplan für "+n+" durch diesen ersetzt werden?":"Die aufgerufene URL enthält einen Stundenplan für "+n+". Diesen Stundenplan setzen?";if(a){let e=!1;for(var l of a.split(", "))if(l.toUpperCase()===n){e=!0;break}e||(t+=" Achtung: Der Stundenplan wird erst angewendet, wenn "+n+" auch ausgewählt ist.")}else t+=" Achtung: Der Stundenplan wird erst angewendet, wenn Vertretungen ausgewählt sind.";confirm(t)&&(e[n]=i,window.localStorage.setItem(s+"-timetables",JSON.stringify(e))),window.location.hash="",plausible("Timetable: Set From Link")}}catch(e){console.error("Error while retrieving timetable from URL",e),t(e)}const c=document.getElementsByClassName("date");function d(){const e=new Date;if(0<c.length&&c[0].innerHTML===e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()){var t,n=e.getHours(),o=e.getMinutes();for(t of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]]){if(!(t[1]<n||t[1]===n&&t[2]<=o)){setTimeout(d,new Date(e.getFullYear(),e.getMonth(),e.getDate(),t[1],t[2]).getTime()-e.getTime());break}for(var i of document.getElementsByClassName("lesson"+t[0]))i.classList.add("grey")}}}d(),window.addEventListener("focus",()=>d());let o;var e,n=document.getElementById("status").textContent;try{if(o=JSON.parse(window.localStorage.getItem(s+"-seen-substitutions")),o.status!==n){var i,u,g,f=Date.now();for(i of Object.keys(o.seenSubstitutions))i<=f&&delete o.seenSubstitutions[i];for([u,g]of Object.entries(o.newSubstitutions))u>f&&(u in o.seenSubstitutions?o.seenSubstitutions[u].push(...g):o.seenSubstitutions[u]=g);o.newSubstitutions={},o.status=n}}catch{}o=o||{seenSubstitutions:{},newSubstitutions:{},status:n};for(e of document.getElementsByClassName("substitutions-box")){var m=e.querySelector(".substitutions-table tbody");if(m){const F=e.querySelector(".date").textContent.trim();var h,[,p,w,b]=F.match(/(\d\d?).(\d\d?).(\d\d\d\d)/),S=Date.UTC(b,w-1,p+1);S in o.seenSubstitutions||(o.seenSubstitutions[S]=[]),S in o.newSubstitutions||(o.newSubstitutions[S]=[]);let n;for(h of m.children){let e=h.querySelector(".group-name");null!=e&&(n=e.textContent.trim());let t=n;for(var v of h.children)v.classList.contains(".group-name")||(t+="#"+v.textContent.trim());o.seenSubstitutions[S].includes(t)||(h.classList.add("new-subs"),o.newSubstitutions[S].includes(t)||o.newSubstitutions[S].push(t))}}}window.localStorage.setItem(s+"-seen-substitutions",JSON.stringify(o));const y=document.getElementById("toggle-notifications"),k=document.getElementById("notifications-info"),L=document.getElementById("notifications-info-none"),E=document.getElementById("notifications-info-all"),I=document.getElementById("notifications-info-selection"),N=document.getElementById("notifications-info-blocked"),T=document.getElementById("notifications-info-failed");function M(o,e){return new Promise((t,n)=>{e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(e=>(console.log("Got push subscription:",e,o?"(active)":"(not active)"),fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e.toJSON(),selection:a,is_active:o})}))).then(e=>e.json()).then(e=>{e.ok?(console.log("Push subscription successful"),t()):(console.error("Push subscription failed",e),n())}).catch(e=>{console.error("Push subscription failed",e),n(e)})})}let B;function C(e,t){switch(console.log("Setting notification-state to",e),"failed"!==(B=e)&&localStorage.setItem(s+"-notification-state",B),localStorage.setItem(s+"-notification-state-all",B),B){case"granted-and-enabled":y.checked=!0,y.disabled=!1,""!==a?k.innerHTML=I.innerHTML:k.innerHTML=E.innerHTML,M(!0,t).catch(e=>{console.error("Push subscription failed",e),C("failed",t)});break;case"denied":y.checked=!1,y.disabled=!0,k.innerHTML=N.innerHTML;break;case"failed":y.checked=!1,y.disabled=!0,k.innerHTML=T.innerHTML;break;case"granted-and-disabled":M(!1,t).catch(e=>{console.error("Push subscription failed",e),C("failed",t)}),y.checked=!1,y.disabled=!1,k.innerHTML=L.innerHTML;break;default:y.checked=!1,y.disabled=!1,k.innerHTML=L.innerHTML}}"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.ready.then(e=>{function t(){return!B.startsWith(Notification.permission)&&"failed"!==B&&(console.log(B+" changed to "+Notification.permission),"granted"===Notification.permission?C("granted-and-disabled",n):C(Notification.permission,n),!0)}var n;console.log("ServiceWorker is active:",e.active),"Notification"in window&&"localStorage"in window&&"PushManager"in window?(n=e,document.getElementById("notifications-not-available-alert").hidden=!0,document.getElementById("toggle-notifications-wrapper").hidden=!1,y.addEventListener("change",()=>{y.checked?(window.Notification.requestPermission().then(e=>{B="granted"===e?"granted-and-enabled":e,C(B,n)}),plausible("Push Subscription",{props:{[s]:"Subscribe"}})):("granted-and-enabled"===B&&C("granted-and-disabled",n),plausible("Push Subscription",{props:{[s]:"Unsubscribe"}}))}),window.addEventListener("focus",t),B=window.localStorage.getItem(s+"-notification-state"),null!=B&&"failed"!==B||(B="default"),t()||C(B,n)):(console.warn("Push Notifications are not supported"),localStorage.setItem(s+"-notification-state-all","unsupported"))}),navigator.serviceWorker.register("/sw.js").then(e=>{console.log("ServiceWorker registration successful:",e)}).catch(e=>console.warn("ServiceWorker registration failed:",e))}):(console.warn("Service Worker is not supported"),localStorage.setItem(s+"-notification-state-all","unsupported"));const O=document.getElementById("online-status");let D=null;function H(){O.textContent="Aktuell",O.classList.add("online"),O.classList.remove("offline","updating")}function P(){O.textContent="Offline",O.classList.add("offline"),O.classList.remove("online","updating")}function W(t=null){D=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates"),D.addEventListener("open",e=>{console.log("WebSocket opened",e),H(),t&&t(e.target)}),D.addEventListener("close",e=>{console.log("WebSocket closed",e),P()}),D.addEventListener("message",e=>{var t=JSON.parse(e.data);console.log("WebSocket message",t),"status"===t.type?(e=t.status)&&(e===document.getElementById("status").textContent?H():window.location.reload()):console.warn("Unknown WebSocket message type",t.type)})}function J(){O.textContent="Aktualisiere...",O.classList.add("updating"),O.classList.remove("online","offline"),D.readyState===D.OPEN?D.send(JSON.stringify({type:"get_status"})):W(e=>e.send(JSON.stringify({type:"get_status"})))}W(),window.addEventListener("focus",()=>{console.log("focus, checking for new substitutions"),J()}),window.addEventListener("online",()=>{console.log("online, checking for new substitutions"),J()}),window.addEventListener("offline",()=>{console.log("offline"),P()}),document.getElementById("themes-block").appendChild(document.getElementById("themes-block-template").content);const x=document.documentElement,A=document.getElementById("themes-system-default"),U=document.getElementById("themes-light"),q=document.getElementById("themes-dark");function j(e){switch(localStorage.setItem("theme",e),e){case"system-default":x.classList.remove("light","dark");break;case"light":x.classList.add("light"),x.classList.remove("dark");break;case"dark":x.classList.add("dark"),x.classList.remove("light")}}switch(localStorage.getItem("theme")){case"light":U.checked=!0;break;case"dark":q.checked=!0}A.addEventListener("change",()=>j("system-default")),U.addEventListener("change",()=>j("light")),q.addEventListener("change",()=>j("dark"));try{let e=localStorage.getItem("theme");"system-default"!==e&&e||(e="system-"+(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),plausible("Features - "+s,{props:{Selection:a?(a.match(/,/g)||[]).length+1:0,Notifications:localStorage.getItem(s+"-notification-state-all"),Theme:e,Timetables:null}})}catch(e){console.error(e)}function _(e,t){for(var n of e)n.addEventListener("click",t),n.addEventListener("auxclick",t)}function K(e){e=e.split(",");plausible(JSON.parse(e[0]),e[1]?{props:JSON.parse(e[1])}:null)}_(document.querySelectorAll("a[data-pa]"),function(e){let t=e.target;var n="auxclick"===e.type&&2===e.which,o="click"===e.type;for(;t&&(void 0===t.tagName||"a"!==t.tagName.toLowerCase()||!t.href);)t=t.parentNode;(n||o)&&K(t.getAttribute("data-pa"));t.target||e.ctrlKey||e.metaKey||e.shiftKey||!o||(setTimeout(function(){location.href=t.href},150),e.preventDefault())}),_(document.querySelectorAll("button[data-pa]"),function(e){e.preventDefault(),K(e.target.getAttribute("data-pa")),setTimeout(function(){e.target.form.submit()},150)})}();
//# sourceMappingURL=substitutions.js.map
