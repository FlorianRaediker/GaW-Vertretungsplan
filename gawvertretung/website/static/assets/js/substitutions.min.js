'use strict';const b=document.getElementsByClassName("date");
function c(){const a=new Date;if(0<b.length&&b[0].innerHTML===a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()){const d=a.getHours(),e=a.getMinutes();for(let f of[["1",8,35],["2",9,25],["3",10,30],["4",11,15],["5",12,20],["6",13,10],["7",14,35],["8",15,25],["9",16,20],["10",17,5]])if(f[1]<d||f[1]===d&&f[2]<=e)for(let a of document.getElementsByClassName("lesson"+f[0]))a.classList.add("grey");else{setTimeout(c,(new Date(a.getFullYear(),a.getMonth(),a.getDate(),f[1],f[2])).getTime()-a.getTime());
break}}}c();let g=window.location.pathname.split("/",2)[1];const h=document.getElementById("online-status");let k=!1;
function l(){if(k)return null;const a=new WebSocket(("http:"===window.location.protocol?"ws:":"wss:")+"//"+window.location.host+window.location.pathname+"api/wait-for-updates");a.addEventListener("open",a=>{k=!0;h.textContent="Aktuell";h.classList.add("online");h.classList.remove("offline");console.log("WebSocket opened",a)});a.addEventListener("close",a=>{k=!1;h.textContent="Keine Verbindung zum Server";h.classList.add("offline");h.classList.remove("online");console.log("WebSocket closed",a)});a.addEventListener("message",
a=>{a=JSON.parse(a.data);console.log("WebSocket message",a);switch(a.type){case "new_substitutions":window.location.reload();break;default:console.warn("Unknown WebSocket message type")}});window.addEventListener("offline",()=>{console.log("offline, closing WebSocket connection");a.close()});return a}l();function m(){const a=l();null!=a&&a.addEventListener("open",()=>{a.send(JSON.stringify({type:"check_status",status:document.getElementById("status").textContent}))})}
window.addEventListener("focus",()=>{m()});window.addEventListener("online",()=>{console.log("online");m()});const n=document.getElementById("selectionInput").value,p=document.getElementById("toggle-notifications"),q=document.getElementById("notifications-info"),r=document.getElementById("notifications-info-none"),t=document.getElementById("notifications-info-all"),u=document.getElementById("notifications-info-selection"),v=document.getElementById("notifications-info-blocked"),w=document.getElementById("notifications-info-failed");
let x;function y(a){var d="=".repeat((4-a.length%4)%4);a=(a+d).replace(/-/g,"+").replace(/_/g,"/");a=atob(a);d=new Uint8Array(a.length);for(let e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}
function z(a){return new Promise((d,e)=>{x.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:y("BDu6tTwQHFlGb36-pLCzwMdgumSlyj_vqMR3I1KahllZd3v2se-LM25vhP3Yv_y0qXYx_KPOVOD2EYTaJaibzo8")}).then(f=>{console.log("Got push subscription:",f,a?"(active)":"(not active)");fetch(window.location.origin+window.location.pathname+"api/subscribe-push",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:f.toJSON(),selection:n,is_active:a})}).then(a=>a.json()).then(a=>
{a.ok?(console.log("Push subscription successful"),d()):(console.error("Push subscription failed"),e())})}).catch(a=>{console.error("Push subscription failed",a);e(a)})})}let A;
function B(a){console.log("Setting notification-state to",a);A=a;window.localStorage.setItem(g+"-notification-state",A);switch(A){case "granted-and-enabled":p.checked=!0;p.disabled=!1;q.innerHTML=""!==n?u.innerHTML.replace("{selection}",n):t.innerHTML;z(!0).catch(()=>{B("failed")});break;case "denied":p.checked=!1;p.disabled=!0;q.innerHTML=v.innerHTML;break;case "failed":p.checked=!1;p.disabled=!0;q.innerHTML=w.innerHTML;break;case "granted-and-disabled":z(!1).catch(()=>{B("failed")});p.checked=!1;
p.disabled=!1;q.innerHTML=r.innerHTML;break;default:case "default":p.checked=!1,p.disabled=!1,q.innerHTML=r.innerHTML}}
function C(){function a(){return A.startsWith(Notification.permission)?!1:("granted"===Notification.permission?B("granted-and-disabled"):B(Notification.permission),!0)}document.getElementById("notifications-block").hidden=!1;p.addEventListener("change",()=>{p.checked?window.Notification.requestPermission().then(a=>{switch(a){case "granted":A="granted-and-enabled";break;default:A=a}B(A)}):"granted-and-enabled"===A&&B("granted-and-disabled")});window.addEventListener("focus",a);A=window.localStorage.getItem(g+
"-notification-state");null==A&&(A="default");a()||B(A)}"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.min.js").then(a=>{x=a;console.log("ServiceWorker registration successful:",a);"Notification"in window?"localStorage"in window?C():console.warn("localStorage is not supported"):console.warn("Notification is not supported")}).catch(a=>console.warn("ServiceWorker registration failed:",a))}):console.warn("serviceWorker is not supported");//# sourceMappingURL=substitutions.min.js.map
